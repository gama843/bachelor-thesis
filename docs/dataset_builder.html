<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.7.0"/>
    <title>dataset_builder API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DatasetBuilder">DatasetBuilder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DatasetBuilder.__init__">DatasetBuilder</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.data_dir">data_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.transform">transform</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.transform_prob">transform_prob</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.random_seed">random_seed</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.vocab">vocab</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.answer_vocab">answer_vocab</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.max_len">max_len</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.train_dataset">train_dataset</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.val_dataset">val_dataset</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatasetBuilder.test_dataset">test_dataset</a>
                        </li>
                        <li>
                                <a class="function" href="#DatasetBuilder._load_data">_load_data</a>
                        </li>
                        <li>
                                <a class="function" href="#DatasetBuilder._generate_samples">_generate_samples</a>
                        </li>
                        <li>
                                <a class="function" href="#DatasetBuilder._compute_max_question_len">_compute_max_question_len</a>
                        </li>
                        <li>
                                <a class="function" href="#DatasetBuilder._build_vocab">_build_vocab</a>
                        </li>
                        <li>
                                <a class="function" href="#DatasetBuilder._build_answer_vocab">_build_answer_vocab</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RelationalDataset">RelationalDataset</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RelationalDataset.__init__">RelationalDataset</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.samples">samples</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.vocab">vocab</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.answer_vocab">answer_vocab</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.max_len">max_len</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.transform">transform</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.transform_prob">transform_prob</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationalDataset.random_seed">random_seed</a>
                        </li>
                        <li>
                                <a class="function" href="#RelationalDataset._tokenize_question">_tokenize_question</a>
                        </li>
                        <li>
                                <a class="function" href="#RelationalDataset._encode_answer">_encode_answer</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ImageAnswerTransform">ImageAnswerTransform</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ImageAnswerTransform.__init__">ImageAnswerTransform</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImageAnswerTransform.image_transform">image_transform</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImageAnswerTransform.text_transform">text_transform</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImageAnswerTransform.state">state</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Rotate180DegreesTransform">Rotate180DegreesTransform</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Rotate180DegreesTransform.__init__">Rotate180DegreesTransform</a>
                        </li>
                        <li>
                                <a class="function" href="#Rotate180DegreesTransform.rotate_image_180">rotate_image_180</a>
                        </li>
                        <li>
                                <a class="function" href="#Rotate180DegreesTransform.modify_answer_based_on_rotation">modify_answer_based_on_rotation</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
dataset_builder    </h1>

                
                        <input id="mod-dataset_builder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-dataset_builder-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">random</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="k">class</span> <span class="nc">DatasetBuilder</span><span class="p">:</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">        Initializes the DatasetBuilder by loading, splitting, and processing the dataset.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">        Parameters:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">        -----------</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">        data_dir : str</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">            The directory containing the images and dataset JSON file.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">        transform : torchvision.transforms.Compose</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">            Transformations to apply to the images.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        transform_prob : float</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">            The probability of applying transformations (default=0).</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        random_seed : int</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">            Random seed for reproducibility (default=42).</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span> <span class="o">=</span> <span class="n">transform_prob</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="c1"># compute vocab and max_len based on the training set</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_vocab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_answer_vocab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_max_question_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="c1"># create the individual datasets</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        @public</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        </span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        Loads the dataset from the &#39;descr.json&#39; file and splits it into train, validation, and test sets.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        Parameters:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        -----------</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        train_size : float</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">            Proportion of the data to be used for training.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        val_size : float</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">            Proportion of the data to be used for validation.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        test_size : float</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">            Proportion of the data to be used for testing.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">total_size</span> <span class="o">=</span> <span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_size</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of train_size (</span><span class="si">{</span><span class="n">train_size</span><span class="si">}</span><span class="s2">), val_size (</span><span class="si">{</span><span class="n">val_size</span><span class="si">}</span><span class="s2">), and test_size (</span><span class="si">{</span><span class="n">test_size</span><span class="si">}</span><span class="s2">) must be 1.0&quot;</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;descr.json&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">img_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="n">train_val_paths</span><span class="p">,</span> <span class="n">test_paths</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">img_paths</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="n">val_relative_size</span> <span class="o">=</span> <span class="n">val_size</span> <span class="o">/</span> <span class="p">(</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="n">train_paths</span><span class="p">,</span> <span class="n">val_paths</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_val_paths</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">val_relative_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">train_paths</span><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">val_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">val_paths</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_paths</span><span class="p">)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">_generate_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">image_paths</span><span class="p">):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        @public</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        Generates samples for the dataset (20 per image: 10 relational, 10 non-relational).</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        Parameters:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        -----------</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        data : dict</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">            The loaded dataset dictionary.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        image_paths : list</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">            A list of image paths corresponding to a specific split.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        Returns:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        --------</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        list</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            A list of samples where each sample is a tuple (image_path, question, answer).</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="n">img_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">image_path</span><span class="p">]</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="k">for</span> <span class="n">obj_info</span> <span class="ow">in</span> <span class="n">img_info</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                <span class="k">if</span> <span class="s1">&#39;question&#39;</span> <span class="ow">in</span> <span class="n">obj_info</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                    <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_path</span><span class="p">),</span> <span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">],</span> <span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">]))</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="n">samples</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">_compute_max_question_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        @public</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        Computes the maximum length of questions in the dataset.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        Parameters:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        -----------</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        samples : list</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            A list of samples where each sample contains a question.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        Returns:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        --------</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        int</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">            The length of the longest question in the dataset.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="n">question_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">question_len</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">max_len</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">_build_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">        @public</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        Builds a vocabulary from the dataset questions and assigns an index to each unique word.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        Parameters:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        -----------</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        samples : list</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">            A list of samples where each sample contains a question.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        min_freq : int</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">            Minimum frequency for a word to be included in the vocabulary (default=1).</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        Returns:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        --------</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        dict</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            A dictionary mapping each word to a unique index.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">word_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="n">word_counter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="n">vocab</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">word_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="n">freq</span> <span class="o">&gt;=</span> <span class="n">min_freq</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                <span class="n">vocab</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">vocab</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">_build_answer_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        @public</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        Builds a vocabulary from the dataset answers, mapping each answer to a unique index.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        Parameters:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        -----------</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        samples : list</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">            A list of samples where each sample contains an answer.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        Returns:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        --------</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        dict</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">            A dictionary mapping each answer to a unique index.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">answer_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">answer_counter</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">answer</span><span class="p">])</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="n">answer_vocab</span> <span class="o">=</span> <span class="p">{</span><span class="n">ans</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ans</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">answer_counter</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="n">answer_vocab</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="k">class</span> <span class="nc">RelationalDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    A PyTorch Dataset class to load relational reasoning data, including both relational </span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">    and non-relational questions. Supports data augmentation and train/val/test splitting.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">    Attributes:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">    -----------</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">    samples : list</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        The dataset samples with image paths, questions, and answers.</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">    vocab : dict</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        A dictionary mapping question words to token indices.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">    answer_vocab : dict</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        A dictionary mapping answers to token indices.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">    max_len : int</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        The maximum length of tokenized questions for padding.</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">    transform : ImageAnswerTransform</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        Data transformations that apply both image and text transformations.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">    transform_prob : float</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        The probability of applying transformations.        </span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">    random_seed : int</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        Random seed for reproducibility and for use in transformations.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">answer_vocab</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span> <span class="o">=</span> <span class="n">answer_vocab</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="n">max_len</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span> <span class="o">=</span> <span class="n">transform_prob</span>        
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        Fetch an image and its corresponding tokenized question-answer pair, applying the appropriate transformations.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Returns:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        --------</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        tuple</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            A tuple (image, tokenized_question, encoded_answer) where image is a transformed image tensor, </span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            tokenized_question is a list of token indices, and encoded_answer is an integer index.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="n">image_path</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="n">img</span><span class="p">,</span> <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">tokenized_question</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_question</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">encoded_answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_answer</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">tokenized_question</span><span class="p">,</span> <span class="n">encoded_answer</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">_tokenize_question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">):</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        @public</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        Tokenizes the question into a list of token indices and pads or truncates to max_len.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Parameters:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        -----------</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        question : str</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            The question to tokenize.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        Returns:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        --------</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        list</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">            A list of token indices.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">question</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">]</span>  <span class="c1"># truncate if longer than max_len</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>  <span class="c1"># pad if shorter than max_len</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="n">tokens</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">_encode_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        @public</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">        Converts an answer into its corresponding index.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        Parameters:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        -----------</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        answer : str</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">            The answer to encode.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        answer_vocab : dict</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">            A dictionary mapping answers to indices.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        Returns:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        --------</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        int</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">            The index of the answer in the answer vocabulary.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">[</span><span class="n">answer</span><span class="p">]</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="k">class</span> <span class="nc">ImageAnswerTransform</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    A class that applies both image and text transformations, allowing </span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">    them to communicate via a shared state. The state can be used to </span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">    pass transformation parameters or results from the image transformation </span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    to the text transformation, allowing for coordinated changes between </span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    the image and the label.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">    Attributes:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">    -----------</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">    image_transform : callable, optional</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        A transformation function for the image. It should accept a PIL Image </span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        and a state dictionary, then return the transformed PIL Image and the updated state.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        </span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    text_transform : callable, optional</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        A transformation function for the label (string). It should accept a string label </span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        and the shared state, then return the transformed label.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        </span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    state : dict, optional</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        A shared state dictionary used to pass information between the image </span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        and text transformations. If not provided, it is initialized as an empty dictionary.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    Methods:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    --------</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">    __call__(img, label)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        Applies the image transformation, updates the shared state, and then </span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        applies the text transformation using the updated state.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        Parameters:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        -----------</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">            The input image to be transformed.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">            </span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        label : str</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">            The label associated with the image, which may be transformed </span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            based on the shared state.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        Returns:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        --------</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">            The transformed image.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        label : str</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">            The transformed label, modified based on the image transformation </span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">            and the state.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span> <span class="o">=</span> <span class="n">image_transform</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">text_transform</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">label</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="k">class</span> <span class="nc">Rotate180DegreesTransform</span><span class="p">(</span><span class="n">ImageAnswerTransform</span><span class="p">):</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">    A specialized ImageAnswerTransform that rotates the image by 180 degrees and modifies the answer accordingly.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">    This class inherits from ImageAnswerTransform and implements the specific functionality of rotating an image</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">    by 180 degrees and transforming the directional answers (&#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;) based on the rotation.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">    Methods:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">    --------</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    rotate_image_180(img, state):</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        Rotates the image by 180 degrees clockwise.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">    modify_answer_based_on_rotation(answer, state):</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        Modifies the answer according to the 180-degree rotation.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        Initializes the Rotate180DegreesTransform with predefined image and text transformations.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">        Parameters:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        -----------</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">        state : dict, optional</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">            A shared state dictionary used to pass information between the image and text transformations.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">            If not provided, it is initialized as an empty dictionary.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">image_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_image_180</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="n">text_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_answer_based_on_rotation</span><span class="p">,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">state</span><span class="o">=</span><span class="n">state</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">rotate_image_180</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        Rotate the image by 180 degrees clockwise.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        Parameters:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        -----------</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">            The image to be rotated.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        state : dict</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            The state used for shared information between image and text transformations.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        Returns:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        --------</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            The rotated image.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        state : dict</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">            The unchanged state dictionary.</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">)</span>  <span class="c1"># 180 degrees clockwise</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">state</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">modify_answer_based_on_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        Modify the answer based on the 180-degree rotation, assuming directional answers (&#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;).</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        Parameters:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        -----------</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        answer : str</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">            The original answer related to the image.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        state : dict</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">            The state used for shared information between image and text transformations.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        Returns:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        --------</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        str</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">            The modified answer after applying the 180-degree rotation.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">answer</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="k">return</span> <span class="s1">&#39;bottom&#39;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="k">return</span> <span class="s1">&#39;top&#39;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>                <span class="k">return</span> <span class="s1">&#39;right&#39;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="k">return</span> <span class="s1">&#39;left&#39;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="k">return</span> <span class="n">answer</span>
</span></pre></div>


            </section>
                <section id="DatasetBuilder">
                            <input id="DatasetBuilder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DatasetBuilder</span>:

                <label class="view-source-button" for="DatasetBuilder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder-12"><a href="#DatasetBuilder-12"><span class="linenos"> 12</span></a><span class="k">class</span> <span class="nc">DatasetBuilder</span><span class="p">:</span>
</span><span id="DatasetBuilder-13"><a href="#DatasetBuilder-13"><span class="linenos"> 13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
</span><span id="DatasetBuilder-14"><a href="#DatasetBuilder-14"><span class="linenos"> 14</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-15"><a href="#DatasetBuilder-15"><span class="linenos"> 15</span></a><span class="sd">        Initializes the DatasetBuilder by loading, splitting, and processing the dataset.</span>
</span><span id="DatasetBuilder-16"><a href="#DatasetBuilder-16"><span class="linenos"> 16</span></a>
</span><span id="DatasetBuilder-17"><a href="#DatasetBuilder-17"><span class="linenos"> 17</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder-18"><a href="#DatasetBuilder-18"><span class="linenos"> 18</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder-19"><a href="#DatasetBuilder-19"><span class="linenos"> 19</span></a><span class="sd">        data_dir : str</span>
</span><span id="DatasetBuilder-20"><a href="#DatasetBuilder-20"><span class="linenos"> 20</span></a><span class="sd">            The directory containing the images and dataset JSON file.</span>
</span><span id="DatasetBuilder-21"><a href="#DatasetBuilder-21"><span class="linenos"> 21</span></a><span class="sd">        transform : torchvision.transforms.Compose</span>
</span><span id="DatasetBuilder-22"><a href="#DatasetBuilder-22"><span class="linenos"> 22</span></a><span class="sd">            Transformations to apply to the images.</span>
</span><span id="DatasetBuilder-23"><a href="#DatasetBuilder-23"><span class="linenos"> 23</span></a><span class="sd">        transform_prob : float</span>
</span><span id="DatasetBuilder-24"><a href="#DatasetBuilder-24"><span class="linenos"> 24</span></a><span class="sd">            The probability of applying transformations (default=0).</span>
</span><span id="DatasetBuilder-25"><a href="#DatasetBuilder-25"><span class="linenos"> 25</span></a><span class="sd">        random_seed : int</span>
</span><span id="DatasetBuilder-26"><a href="#DatasetBuilder-26"><span class="linenos"> 26</span></a><span class="sd">            Random seed for reproducibility (default=42).</span>
</span><span id="DatasetBuilder-27"><a href="#DatasetBuilder-27"><span class="linenos"> 27</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-28"><a href="#DatasetBuilder-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
</span><span id="DatasetBuilder-29"><a href="#DatasetBuilder-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
</span><span id="DatasetBuilder-30"><a href="#DatasetBuilder-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span> <span class="o">=</span> <span class="n">transform_prob</span>
</span><span id="DatasetBuilder-31"><a href="#DatasetBuilder-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="DatasetBuilder-32"><a href="#DatasetBuilder-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
</span><span id="DatasetBuilder-33"><a href="#DatasetBuilder-33"><span class="linenos"> 33</span></a>
</span><span id="DatasetBuilder-34"><a href="#DatasetBuilder-34"><span class="linenos"> 34</span></a>        <span class="c1"># compute vocab and max_len based on the training set</span>
</span><span id="DatasetBuilder-35"><a href="#DatasetBuilder-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_vocab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="DatasetBuilder-36"><a href="#DatasetBuilder-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_answer_vocab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="DatasetBuilder-37"><a href="#DatasetBuilder-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_max_question_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="DatasetBuilder-38"><a href="#DatasetBuilder-38"><span class="linenos"> 38</span></a>
</span><span id="DatasetBuilder-39"><a href="#DatasetBuilder-39"><span class="linenos"> 39</span></a>        <span class="c1"># create the individual datasets</span>
</span><span id="DatasetBuilder-40"><a href="#DatasetBuilder-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder-41"><a href="#DatasetBuilder-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder-42"><a href="#DatasetBuilder-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder-43"><a href="#DatasetBuilder-43"><span class="linenos"> 43</span></a>
</span><span id="DatasetBuilder-44"><a href="#DatasetBuilder-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span><span id="DatasetBuilder-45"><a href="#DatasetBuilder-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-46"><a href="#DatasetBuilder-46"><span class="linenos"> 46</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder-47"><a href="#DatasetBuilder-47"><span class="linenos"> 47</span></a><span class="sd">        </span>
</span><span id="DatasetBuilder-48"><a href="#DatasetBuilder-48"><span class="linenos"> 48</span></a><span class="sd">        Loads the dataset from the &#39;descr.json&#39; file and splits it into train, validation, and test sets.</span>
</span><span id="DatasetBuilder-49"><a href="#DatasetBuilder-49"><span class="linenos"> 49</span></a>
</span><span id="DatasetBuilder-50"><a href="#DatasetBuilder-50"><span class="linenos"> 50</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder-51"><a href="#DatasetBuilder-51"><span class="linenos"> 51</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder-52"><a href="#DatasetBuilder-52"><span class="linenos"> 52</span></a><span class="sd">        train_size : float</span>
</span><span id="DatasetBuilder-53"><a href="#DatasetBuilder-53"><span class="linenos"> 53</span></a><span class="sd">            Proportion of the data to be used for training.</span>
</span><span id="DatasetBuilder-54"><a href="#DatasetBuilder-54"><span class="linenos"> 54</span></a><span class="sd">        val_size : float</span>
</span><span id="DatasetBuilder-55"><a href="#DatasetBuilder-55"><span class="linenos"> 55</span></a><span class="sd">            Proportion of the data to be used for validation.</span>
</span><span id="DatasetBuilder-56"><a href="#DatasetBuilder-56"><span class="linenos"> 56</span></a><span class="sd">        test_size : float</span>
</span><span id="DatasetBuilder-57"><a href="#DatasetBuilder-57"><span class="linenos"> 57</span></a><span class="sd">            Proportion of the data to be used for testing.</span>
</span><span id="DatasetBuilder-58"><a href="#DatasetBuilder-58"><span class="linenos"> 58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-59"><a href="#DatasetBuilder-59"><span class="linenos"> 59</span></a>        <span class="n">total_size</span> <span class="o">=</span> <span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span>
</span><span id="DatasetBuilder-60"><a href="#DatasetBuilder-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_size</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
</span><span id="DatasetBuilder-61"><a href="#DatasetBuilder-61"><span class="linenos"> 61</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of train_size (</span><span class="si">{</span><span class="n">train_size</span><span class="si">}</span><span class="s2">), val_size (</span><span class="si">{</span><span class="n">val_size</span><span class="si">}</span><span class="s2">), and test_size (</span><span class="si">{</span><span class="n">test_size</span><span class="si">}</span><span class="s2">) must be 1.0&quot;</span><span class="p">)</span>
</span><span id="DatasetBuilder-62"><a href="#DatasetBuilder-62"><span class="linenos"> 62</span></a>
</span><span id="DatasetBuilder-63"><a href="#DatasetBuilder-63"><span class="linenos"> 63</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;descr.json&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="DatasetBuilder-64"><a href="#DatasetBuilder-64"><span class="linenos"> 64</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="DatasetBuilder-65"><a href="#DatasetBuilder-65"><span class="linenos"> 65</span></a>
</span><span id="DatasetBuilder-66"><a href="#DatasetBuilder-66"><span class="linenos"> 66</span></a>        <span class="n">img_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="DatasetBuilder-67"><a href="#DatasetBuilder-67"><span class="linenos"> 67</span></a>
</span><span id="DatasetBuilder-68"><a href="#DatasetBuilder-68"><span class="linenos"> 68</span></a>        <span class="n">train_val_paths</span><span class="p">,</span> <span class="n">test_paths</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">img_paths</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder-69"><a href="#DatasetBuilder-69"><span class="linenos"> 69</span></a>        <span class="n">val_relative_size</span> <span class="o">=</span> <span class="n">val_size</span> <span class="o">/</span> <span class="p">(</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">)</span>
</span><span id="DatasetBuilder-70"><a href="#DatasetBuilder-70"><span class="linenos"> 70</span></a>        <span class="n">train_paths</span><span class="p">,</span> <span class="n">val_paths</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_val_paths</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">val_relative_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder-71"><a href="#DatasetBuilder-71"><span class="linenos"> 71</span></a>
</span><span id="DatasetBuilder-72"><a href="#DatasetBuilder-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">train_paths</span><span class="p">)</span>
</span><span id="DatasetBuilder-73"><a href="#DatasetBuilder-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">val_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">val_paths</span><span class="p">)</span>
</span><span id="DatasetBuilder-74"><a href="#DatasetBuilder-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_paths</span><span class="p">)</span>
</span><span id="DatasetBuilder-75"><a href="#DatasetBuilder-75"><span class="linenos"> 75</span></a>
</span><span id="DatasetBuilder-76"><a href="#DatasetBuilder-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">_generate_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">image_paths</span><span class="p">):</span>
</span><span id="DatasetBuilder-77"><a href="#DatasetBuilder-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-78"><a href="#DatasetBuilder-78"><span class="linenos"> 78</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder-79"><a href="#DatasetBuilder-79"><span class="linenos"> 79</span></a>
</span><span id="DatasetBuilder-80"><a href="#DatasetBuilder-80"><span class="linenos"> 80</span></a><span class="sd">        Generates samples for the dataset (20 per image: 10 relational, 10 non-relational).</span>
</span><span id="DatasetBuilder-81"><a href="#DatasetBuilder-81"><span class="linenos"> 81</span></a>
</span><span id="DatasetBuilder-82"><a href="#DatasetBuilder-82"><span class="linenos"> 82</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder-83"><a href="#DatasetBuilder-83"><span class="linenos"> 83</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder-84"><a href="#DatasetBuilder-84"><span class="linenos"> 84</span></a><span class="sd">        data : dict</span>
</span><span id="DatasetBuilder-85"><a href="#DatasetBuilder-85"><span class="linenos"> 85</span></a><span class="sd">            The loaded dataset dictionary.</span>
</span><span id="DatasetBuilder-86"><a href="#DatasetBuilder-86"><span class="linenos"> 86</span></a><span class="sd">        image_paths : list</span>
</span><span id="DatasetBuilder-87"><a href="#DatasetBuilder-87"><span class="linenos"> 87</span></a><span class="sd">            A list of image paths corresponding to a specific split.</span>
</span><span id="DatasetBuilder-88"><a href="#DatasetBuilder-88"><span class="linenos"> 88</span></a>
</span><span id="DatasetBuilder-89"><a href="#DatasetBuilder-89"><span class="linenos"> 89</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder-90"><a href="#DatasetBuilder-90"><span class="linenos"> 90</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder-91"><a href="#DatasetBuilder-91"><span class="linenos"> 91</span></a><span class="sd">        list</span>
</span><span id="DatasetBuilder-92"><a href="#DatasetBuilder-92"><span class="linenos"> 92</span></a><span class="sd">            A list of samples where each sample is a tuple (image_path, question, answer).</span>
</span><span id="DatasetBuilder-93"><a href="#DatasetBuilder-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-94"><a href="#DatasetBuilder-94"><span class="linenos"> 94</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DatasetBuilder-95"><a href="#DatasetBuilder-95"><span class="linenos"> 95</span></a>        <span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
</span><span id="DatasetBuilder-96"><a href="#DatasetBuilder-96"><span class="linenos"> 96</span></a>            <span class="n">img_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">image_path</span><span class="p">]</span>
</span><span id="DatasetBuilder-97"><a href="#DatasetBuilder-97"><span class="linenos"> 97</span></a>            <span class="k">for</span> <span class="n">obj_info</span> <span class="ow">in</span> <span class="n">img_info</span><span class="p">:</span>
</span><span id="DatasetBuilder-98"><a href="#DatasetBuilder-98"><span class="linenos"> 98</span></a>                <span class="k">if</span> <span class="s1">&#39;question&#39;</span> <span class="ow">in</span> <span class="n">obj_info</span><span class="p">:</span>
</span><span id="DatasetBuilder-99"><a href="#DatasetBuilder-99"><span class="linenos"> 99</span></a>                    <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_path</span><span class="p">),</span> <span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">],</span> <span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">]))</span>
</span><span id="DatasetBuilder-100"><a href="#DatasetBuilder-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="n">samples</span>
</span><span id="DatasetBuilder-101"><a href="#DatasetBuilder-101"><span class="linenos">101</span></a>
</span><span id="DatasetBuilder-102"><a href="#DatasetBuilder-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">_compute_max_question_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
</span><span id="DatasetBuilder-103"><a href="#DatasetBuilder-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-104"><a href="#DatasetBuilder-104"><span class="linenos">104</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder-105"><a href="#DatasetBuilder-105"><span class="linenos">105</span></a>
</span><span id="DatasetBuilder-106"><a href="#DatasetBuilder-106"><span class="linenos">106</span></a><span class="sd">        Computes the maximum length of questions in the dataset.</span>
</span><span id="DatasetBuilder-107"><a href="#DatasetBuilder-107"><span class="linenos">107</span></a>
</span><span id="DatasetBuilder-108"><a href="#DatasetBuilder-108"><span class="linenos">108</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder-109"><a href="#DatasetBuilder-109"><span class="linenos">109</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder-110"><a href="#DatasetBuilder-110"><span class="linenos">110</span></a><span class="sd">        samples : list</span>
</span><span id="DatasetBuilder-111"><a href="#DatasetBuilder-111"><span class="linenos">111</span></a><span class="sd">            A list of samples where each sample contains a question.</span>
</span><span id="DatasetBuilder-112"><a href="#DatasetBuilder-112"><span class="linenos">112</span></a>
</span><span id="DatasetBuilder-113"><a href="#DatasetBuilder-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder-114"><a href="#DatasetBuilder-114"><span class="linenos">114</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder-115"><a href="#DatasetBuilder-115"><span class="linenos">115</span></a><span class="sd">        int</span>
</span><span id="DatasetBuilder-116"><a href="#DatasetBuilder-116"><span class="linenos">116</span></a><span class="sd">            The length of the longest question in the dataset.</span>
</span><span id="DatasetBuilder-117"><a href="#DatasetBuilder-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-118"><a href="#DatasetBuilder-118"><span class="linenos">118</span></a>        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DatasetBuilder-119"><a href="#DatasetBuilder-119"><span class="linenos">119</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="DatasetBuilder-120"><a href="#DatasetBuilder-120"><span class="linenos">120</span></a>            <span class="n">question_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="DatasetBuilder-121"><a href="#DatasetBuilder-121"><span class="linenos">121</span></a>            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">question_len</span><span class="p">)</span>
</span><span id="DatasetBuilder-122"><a href="#DatasetBuilder-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="n">max_len</span>
</span><span id="DatasetBuilder-123"><a href="#DatasetBuilder-123"><span class="linenos">123</span></a>
</span><span id="DatasetBuilder-124"><a href="#DatasetBuilder-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="nf">_build_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="DatasetBuilder-125"><a href="#DatasetBuilder-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-126"><a href="#DatasetBuilder-126"><span class="linenos">126</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder-127"><a href="#DatasetBuilder-127"><span class="linenos">127</span></a>
</span><span id="DatasetBuilder-128"><a href="#DatasetBuilder-128"><span class="linenos">128</span></a><span class="sd">        Builds a vocabulary from the dataset questions and assigns an index to each unique word.</span>
</span><span id="DatasetBuilder-129"><a href="#DatasetBuilder-129"><span class="linenos">129</span></a>
</span><span id="DatasetBuilder-130"><a href="#DatasetBuilder-130"><span class="linenos">130</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder-131"><a href="#DatasetBuilder-131"><span class="linenos">131</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder-132"><a href="#DatasetBuilder-132"><span class="linenos">132</span></a><span class="sd">        samples : list</span>
</span><span id="DatasetBuilder-133"><a href="#DatasetBuilder-133"><span class="linenos">133</span></a><span class="sd">            A list of samples where each sample contains a question.</span>
</span><span id="DatasetBuilder-134"><a href="#DatasetBuilder-134"><span class="linenos">134</span></a><span class="sd">        min_freq : int</span>
</span><span id="DatasetBuilder-135"><a href="#DatasetBuilder-135"><span class="linenos">135</span></a><span class="sd">            Minimum frequency for a word to be included in the vocabulary (default=1).</span>
</span><span id="DatasetBuilder-136"><a href="#DatasetBuilder-136"><span class="linenos">136</span></a>
</span><span id="DatasetBuilder-137"><a href="#DatasetBuilder-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder-138"><a href="#DatasetBuilder-138"><span class="linenos">138</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder-139"><a href="#DatasetBuilder-139"><span class="linenos">139</span></a><span class="sd">        dict</span>
</span><span id="DatasetBuilder-140"><a href="#DatasetBuilder-140"><span class="linenos">140</span></a><span class="sd">            A dictionary mapping each word to a unique index.</span>
</span><span id="DatasetBuilder-141"><a href="#DatasetBuilder-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-142"><a href="#DatasetBuilder-142"><span class="linenos">142</span></a>        <span class="n">word_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DatasetBuilder-143"><a href="#DatasetBuilder-143"><span class="linenos">143</span></a>
</span><span id="DatasetBuilder-144"><a href="#DatasetBuilder-144"><span class="linenos">144</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="DatasetBuilder-145"><a href="#DatasetBuilder-145"><span class="linenos">145</span></a>            <span class="n">word_counter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="DatasetBuilder-146"><a href="#DatasetBuilder-146"><span class="linenos">146</span></a>
</span><span id="DatasetBuilder-147"><a href="#DatasetBuilder-147"><span class="linenos">147</span></a>        <span class="n">vocab</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="DatasetBuilder-148"><a href="#DatasetBuilder-148"><span class="linenos">148</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">word_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DatasetBuilder-149"><a href="#DatasetBuilder-149"><span class="linenos">149</span></a>            <span class="k">if</span> <span class="n">freq</span> <span class="o">&gt;=</span> <span class="n">min_freq</span><span class="p">:</span>
</span><span id="DatasetBuilder-150"><a href="#DatasetBuilder-150"><span class="linenos">150</span></a>                <span class="n">vocab</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
</span><span id="DatasetBuilder-151"><a href="#DatasetBuilder-151"><span class="linenos">151</span></a>
</span><span id="DatasetBuilder-152"><a href="#DatasetBuilder-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="n">vocab</span>
</span><span id="DatasetBuilder-153"><a href="#DatasetBuilder-153"><span class="linenos">153</span></a>
</span><span id="DatasetBuilder-154"><a href="#DatasetBuilder-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">_build_answer_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
</span><span id="DatasetBuilder-155"><a href="#DatasetBuilder-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-156"><a href="#DatasetBuilder-156"><span class="linenos">156</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder-157"><a href="#DatasetBuilder-157"><span class="linenos">157</span></a>
</span><span id="DatasetBuilder-158"><a href="#DatasetBuilder-158"><span class="linenos">158</span></a><span class="sd">        Builds a vocabulary from the dataset answers, mapping each answer to a unique index.</span>
</span><span id="DatasetBuilder-159"><a href="#DatasetBuilder-159"><span class="linenos">159</span></a>
</span><span id="DatasetBuilder-160"><a href="#DatasetBuilder-160"><span class="linenos">160</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder-161"><a href="#DatasetBuilder-161"><span class="linenos">161</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder-162"><a href="#DatasetBuilder-162"><span class="linenos">162</span></a><span class="sd">        samples : list</span>
</span><span id="DatasetBuilder-163"><a href="#DatasetBuilder-163"><span class="linenos">163</span></a><span class="sd">            A list of samples where each sample contains an answer.</span>
</span><span id="DatasetBuilder-164"><a href="#DatasetBuilder-164"><span class="linenos">164</span></a>
</span><span id="DatasetBuilder-165"><a href="#DatasetBuilder-165"><span class="linenos">165</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder-166"><a href="#DatasetBuilder-166"><span class="linenos">166</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder-167"><a href="#DatasetBuilder-167"><span class="linenos">167</span></a><span class="sd">        dict</span>
</span><span id="DatasetBuilder-168"><a href="#DatasetBuilder-168"><span class="linenos">168</span></a><span class="sd">            A dictionary mapping each answer to a unique index.</span>
</span><span id="DatasetBuilder-169"><a href="#DatasetBuilder-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder-170"><a href="#DatasetBuilder-170"><span class="linenos">170</span></a>        <span class="n">answer_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DatasetBuilder-171"><a href="#DatasetBuilder-171"><span class="linenos">171</span></a>
</span><span id="DatasetBuilder-172"><a href="#DatasetBuilder-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="DatasetBuilder-173"><a href="#DatasetBuilder-173"><span class="linenos">173</span></a>            <span class="n">answer_counter</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">answer</span><span class="p">])</span>
</span><span id="DatasetBuilder-174"><a href="#DatasetBuilder-174"><span class="linenos">174</span></a>
</span><span id="DatasetBuilder-175"><a href="#DatasetBuilder-175"><span class="linenos">175</span></a>        <span class="n">answer_vocab</span> <span class="o">=</span> <span class="p">{</span><span class="n">ans</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ans</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">answer_counter</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
</span><span id="DatasetBuilder-176"><a href="#DatasetBuilder-176"><span class="linenos">176</span></a>
</span><span id="DatasetBuilder-177"><a href="#DatasetBuilder-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="n">answer_vocab</span>
</span></pre></div>


    

                            <div id="DatasetBuilder.__init__" class="classattr">
                                        <input id="DatasetBuilder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DatasetBuilder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data_dir</span>, </span><span class="param"><span class="n">transform</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span></span>)</span>

                <label class="view-source-button" for="DatasetBuilder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder.__init__-13"><a href="#DatasetBuilder.__init__-13"><span class="linenos">13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
</span><span id="DatasetBuilder.__init__-14"><a href="#DatasetBuilder.__init__-14"><span class="linenos">14</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder.__init__-15"><a href="#DatasetBuilder.__init__-15"><span class="linenos">15</span></a><span class="sd">        Initializes the DatasetBuilder by loading, splitting, and processing the dataset.</span>
</span><span id="DatasetBuilder.__init__-16"><a href="#DatasetBuilder.__init__-16"><span class="linenos">16</span></a>
</span><span id="DatasetBuilder.__init__-17"><a href="#DatasetBuilder.__init__-17"><span class="linenos">17</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder.__init__-18"><a href="#DatasetBuilder.__init__-18"><span class="linenos">18</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder.__init__-19"><a href="#DatasetBuilder.__init__-19"><span class="linenos">19</span></a><span class="sd">        data_dir : str</span>
</span><span id="DatasetBuilder.__init__-20"><a href="#DatasetBuilder.__init__-20"><span class="linenos">20</span></a><span class="sd">            The directory containing the images and dataset JSON file.</span>
</span><span id="DatasetBuilder.__init__-21"><a href="#DatasetBuilder.__init__-21"><span class="linenos">21</span></a><span class="sd">        transform : torchvision.transforms.Compose</span>
</span><span id="DatasetBuilder.__init__-22"><a href="#DatasetBuilder.__init__-22"><span class="linenos">22</span></a><span class="sd">            Transformations to apply to the images.</span>
</span><span id="DatasetBuilder.__init__-23"><a href="#DatasetBuilder.__init__-23"><span class="linenos">23</span></a><span class="sd">        transform_prob : float</span>
</span><span id="DatasetBuilder.__init__-24"><a href="#DatasetBuilder.__init__-24"><span class="linenos">24</span></a><span class="sd">            The probability of applying transformations (default=0).</span>
</span><span id="DatasetBuilder.__init__-25"><a href="#DatasetBuilder.__init__-25"><span class="linenos">25</span></a><span class="sd">        random_seed : int</span>
</span><span id="DatasetBuilder.__init__-26"><a href="#DatasetBuilder.__init__-26"><span class="linenos">26</span></a><span class="sd">            Random seed for reproducibility (default=42).</span>
</span><span id="DatasetBuilder.__init__-27"><a href="#DatasetBuilder.__init__-27"><span class="linenos">27</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder.__init__-28"><a href="#DatasetBuilder.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
</span><span id="DatasetBuilder.__init__-29"><a href="#DatasetBuilder.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
</span><span id="DatasetBuilder.__init__-30"><a href="#DatasetBuilder.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span> <span class="o">=</span> <span class="n">transform_prob</span>
</span><span id="DatasetBuilder.__init__-31"><a href="#DatasetBuilder.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="DatasetBuilder.__init__-32"><a href="#DatasetBuilder.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
</span><span id="DatasetBuilder.__init__-33"><a href="#DatasetBuilder.__init__-33"><span class="linenos">33</span></a>
</span><span id="DatasetBuilder.__init__-34"><a href="#DatasetBuilder.__init__-34"><span class="linenos">34</span></a>        <span class="c1"># compute vocab and max_len based on the training set</span>
</span><span id="DatasetBuilder.__init__-35"><a href="#DatasetBuilder.__init__-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_vocab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="DatasetBuilder.__init__-36"><a href="#DatasetBuilder.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_answer_vocab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="DatasetBuilder.__init__-37"><a href="#DatasetBuilder.__init__-37"><span class="linenos">37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_max_question_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">)</span>
</span><span id="DatasetBuilder.__init__-38"><a href="#DatasetBuilder.__init__-38"><span class="linenos">38</span></a>
</span><span id="DatasetBuilder.__init__-39"><a href="#DatasetBuilder.__init__-39"><span class="linenos">39</span></a>        <span class="c1"># create the individual datasets</span>
</span><span id="DatasetBuilder.__init__-40"><a href="#DatasetBuilder.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder.__init__-41"><a href="#DatasetBuilder.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder.__init__-42"><a href="#DatasetBuilder.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">RelationalDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the DatasetBuilder by loading, splitting, and processing the dataset.</p>

<h2 id="parameters">Parameters:</h2>

<p>data_dir : str
    The directory containing the images and dataset JSON file.
transform : torchvision.transforms.Compose
    Transformations to apply to the images.
transform_prob : float
    The probability of applying transformations (default=0).
random_seed : int
    Random seed for reproducibility (default=42).</p>
</div>


                            </div>
                            <div id="DatasetBuilder.data_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">data_dir</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.data_dir"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.transform" class="classattr">
                                <div class="attr variable">
            <span class="name">transform</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.transform"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.transform_prob" class="classattr">
                                <div class="attr variable">
            <span class="name">transform_prob</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.transform_prob"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.random_seed" class="classattr">
                                <div class="attr variable">
            <span class="name">random_seed</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.random_seed"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.vocab" class="classattr">
                                <div class="attr variable">
            <span class="name">vocab</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.vocab"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.answer_vocab" class="classattr">
                                <div class="attr variable">
            <span class="name">answer_vocab</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.answer_vocab"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.max_len" class="classattr">
                                <div class="attr variable">
            <span class="name">max_len</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.max_len"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.train_dataset" class="classattr">
                                <div class="attr variable">
            <span class="name">train_dataset</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.train_dataset"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.val_dataset" class="classattr">
                                <div class="attr variable">
            <span class="name">val_dataset</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.val_dataset"></a>
    
    

                            </div>
                            <div id="DatasetBuilder.test_dataset" class="classattr">
                                <div class="attr variable">
            <span class="name">test_dataset</span>

        
    </div>
    <a class="headerlink" href="#DatasetBuilder.test_dataset"></a>
    
    

                            </div>
                            <div id="DatasetBuilder._load_data" class="classattr">
                                        <input id="DatasetBuilder._load_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_load_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">train_size</span><span class="o">=</span><span class="mf">0.7</span>, </span><span class="param"><span class="n">val_size</span><span class="o">=</span><span class="mf">0.1</span>, </span><span class="param"><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DatasetBuilder._load_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder._load_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder._load_data-44"><a href="#DatasetBuilder._load_data-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span><span id="DatasetBuilder._load_data-45"><a href="#DatasetBuilder._load_data-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._load_data-46"><a href="#DatasetBuilder._load_data-46"><span class="linenos">46</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder._load_data-47"><a href="#DatasetBuilder._load_data-47"><span class="linenos">47</span></a><span class="sd">        </span>
</span><span id="DatasetBuilder._load_data-48"><a href="#DatasetBuilder._load_data-48"><span class="linenos">48</span></a><span class="sd">        Loads the dataset from the &#39;descr.json&#39; file and splits it into train, validation, and test sets.</span>
</span><span id="DatasetBuilder._load_data-49"><a href="#DatasetBuilder._load_data-49"><span class="linenos">49</span></a>
</span><span id="DatasetBuilder._load_data-50"><a href="#DatasetBuilder._load_data-50"><span class="linenos">50</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder._load_data-51"><a href="#DatasetBuilder._load_data-51"><span class="linenos">51</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder._load_data-52"><a href="#DatasetBuilder._load_data-52"><span class="linenos">52</span></a><span class="sd">        train_size : float</span>
</span><span id="DatasetBuilder._load_data-53"><a href="#DatasetBuilder._load_data-53"><span class="linenos">53</span></a><span class="sd">            Proportion of the data to be used for training.</span>
</span><span id="DatasetBuilder._load_data-54"><a href="#DatasetBuilder._load_data-54"><span class="linenos">54</span></a><span class="sd">        val_size : float</span>
</span><span id="DatasetBuilder._load_data-55"><a href="#DatasetBuilder._load_data-55"><span class="linenos">55</span></a><span class="sd">            Proportion of the data to be used for validation.</span>
</span><span id="DatasetBuilder._load_data-56"><a href="#DatasetBuilder._load_data-56"><span class="linenos">56</span></a><span class="sd">        test_size : float</span>
</span><span id="DatasetBuilder._load_data-57"><a href="#DatasetBuilder._load_data-57"><span class="linenos">57</span></a><span class="sd">            Proportion of the data to be used for testing.</span>
</span><span id="DatasetBuilder._load_data-58"><a href="#DatasetBuilder._load_data-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._load_data-59"><a href="#DatasetBuilder._load_data-59"><span class="linenos">59</span></a>        <span class="n">total_size</span> <span class="o">=</span> <span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span>
</span><span id="DatasetBuilder._load_data-60"><a href="#DatasetBuilder._load_data-60"><span class="linenos">60</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_size</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
</span><span id="DatasetBuilder._load_data-61"><a href="#DatasetBuilder._load_data-61"><span class="linenos">61</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of train_size (</span><span class="si">{</span><span class="n">train_size</span><span class="si">}</span><span class="s2">), val_size (</span><span class="si">{</span><span class="n">val_size</span><span class="si">}</span><span class="s2">), and test_size (</span><span class="si">{</span><span class="n">test_size</span><span class="si">}</span><span class="s2">) must be 1.0&quot;</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-62"><a href="#DatasetBuilder._load_data-62"><span class="linenos">62</span></a>
</span><span id="DatasetBuilder._load_data-63"><a href="#DatasetBuilder._load_data-63"><span class="linenos">63</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;descr.json&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="DatasetBuilder._load_data-64"><a href="#DatasetBuilder._load_data-64"><span class="linenos">64</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-65"><a href="#DatasetBuilder._load_data-65"><span class="linenos">65</span></a>
</span><span id="DatasetBuilder._load_data-66"><a href="#DatasetBuilder._load_data-66"><span class="linenos">66</span></a>        <span class="n">img_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="DatasetBuilder._load_data-67"><a href="#DatasetBuilder._load_data-67"><span class="linenos">67</span></a>
</span><span id="DatasetBuilder._load_data-68"><a href="#DatasetBuilder._load_data-68"><span class="linenos">68</span></a>        <span class="n">train_val_paths</span><span class="p">,</span> <span class="n">test_paths</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">img_paths</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-69"><a href="#DatasetBuilder._load_data-69"><span class="linenos">69</span></a>        <span class="n">val_relative_size</span> <span class="o">=</span> <span class="n">val_size</span> <span class="o">/</span> <span class="p">(</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-70"><a href="#DatasetBuilder._load_data-70"><span class="linenos">70</span></a>        <span class="n">train_paths</span><span class="p">,</span> <span class="n">val_paths</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_val_paths</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">val_relative_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-71"><a href="#DatasetBuilder._load_data-71"><span class="linenos">71</span></a>
</span><span id="DatasetBuilder._load_data-72"><a href="#DatasetBuilder._load_data-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">train_paths</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-73"><a href="#DatasetBuilder._load_data-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">val_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">val_paths</span><span class="p">)</span>
</span><span id="DatasetBuilder._load_data-74"><a href="#DatasetBuilder._load_data-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_paths</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Loads the dataset from the 'descr.json' file and splits it into train, validation, and test sets.</p>

<h2 id="parameters">Parameters:</h2>

<p>train_size : float
    Proportion of the data to be used for training.
val_size : float
    Proportion of the data to be used for validation.
test_size : float
    Proportion of the data to be used for testing.</p>
</div>


                            </div>
                            <div id="DatasetBuilder._generate_samples" class="classattr">
                                        <input id="DatasetBuilder._generate_samples-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_generate_samples</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">image_paths</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DatasetBuilder._generate_samples-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder._generate_samples"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder._generate_samples-76"><a href="#DatasetBuilder._generate_samples-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">_generate_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">image_paths</span><span class="p">):</span>
</span><span id="DatasetBuilder._generate_samples-77"><a href="#DatasetBuilder._generate_samples-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._generate_samples-78"><a href="#DatasetBuilder._generate_samples-78"><span class="linenos"> 78</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder._generate_samples-79"><a href="#DatasetBuilder._generate_samples-79"><span class="linenos"> 79</span></a>
</span><span id="DatasetBuilder._generate_samples-80"><a href="#DatasetBuilder._generate_samples-80"><span class="linenos"> 80</span></a><span class="sd">        Generates samples for the dataset (20 per image: 10 relational, 10 non-relational).</span>
</span><span id="DatasetBuilder._generate_samples-81"><a href="#DatasetBuilder._generate_samples-81"><span class="linenos"> 81</span></a>
</span><span id="DatasetBuilder._generate_samples-82"><a href="#DatasetBuilder._generate_samples-82"><span class="linenos"> 82</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder._generate_samples-83"><a href="#DatasetBuilder._generate_samples-83"><span class="linenos"> 83</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder._generate_samples-84"><a href="#DatasetBuilder._generate_samples-84"><span class="linenos"> 84</span></a><span class="sd">        data : dict</span>
</span><span id="DatasetBuilder._generate_samples-85"><a href="#DatasetBuilder._generate_samples-85"><span class="linenos"> 85</span></a><span class="sd">            The loaded dataset dictionary.</span>
</span><span id="DatasetBuilder._generate_samples-86"><a href="#DatasetBuilder._generate_samples-86"><span class="linenos"> 86</span></a><span class="sd">        image_paths : list</span>
</span><span id="DatasetBuilder._generate_samples-87"><a href="#DatasetBuilder._generate_samples-87"><span class="linenos"> 87</span></a><span class="sd">            A list of image paths corresponding to a specific split.</span>
</span><span id="DatasetBuilder._generate_samples-88"><a href="#DatasetBuilder._generate_samples-88"><span class="linenos"> 88</span></a>
</span><span id="DatasetBuilder._generate_samples-89"><a href="#DatasetBuilder._generate_samples-89"><span class="linenos"> 89</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder._generate_samples-90"><a href="#DatasetBuilder._generate_samples-90"><span class="linenos"> 90</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder._generate_samples-91"><a href="#DatasetBuilder._generate_samples-91"><span class="linenos"> 91</span></a><span class="sd">        list</span>
</span><span id="DatasetBuilder._generate_samples-92"><a href="#DatasetBuilder._generate_samples-92"><span class="linenos"> 92</span></a><span class="sd">            A list of samples where each sample is a tuple (image_path, question, answer).</span>
</span><span id="DatasetBuilder._generate_samples-93"><a href="#DatasetBuilder._generate_samples-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._generate_samples-94"><a href="#DatasetBuilder._generate_samples-94"><span class="linenos"> 94</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DatasetBuilder._generate_samples-95"><a href="#DatasetBuilder._generate_samples-95"><span class="linenos"> 95</span></a>        <span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
</span><span id="DatasetBuilder._generate_samples-96"><a href="#DatasetBuilder._generate_samples-96"><span class="linenos"> 96</span></a>            <span class="n">img_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">image_path</span><span class="p">]</span>
</span><span id="DatasetBuilder._generate_samples-97"><a href="#DatasetBuilder._generate_samples-97"><span class="linenos"> 97</span></a>            <span class="k">for</span> <span class="n">obj_info</span> <span class="ow">in</span> <span class="n">img_info</span><span class="p">:</span>
</span><span id="DatasetBuilder._generate_samples-98"><a href="#DatasetBuilder._generate_samples-98"><span class="linenos"> 98</span></a>                <span class="k">if</span> <span class="s1">&#39;question&#39;</span> <span class="ow">in</span> <span class="n">obj_info</span><span class="p">:</span>
</span><span id="DatasetBuilder._generate_samples-99"><a href="#DatasetBuilder._generate_samples-99"><span class="linenos"> 99</span></a>                    <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">image_path</span><span class="p">),</span> <span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">],</span> <span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">]))</span>
</span><span id="DatasetBuilder._generate_samples-100"><a href="#DatasetBuilder._generate_samples-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="n">samples</span>
</span></pre></div>


            <div class="docstring"><p>Generates samples for the dataset (20 per image: 10 relational, 10 non-relational).</p>

<h2 id="parameters">Parameters:</h2>

<p>data : dict
    The loaded dataset dictionary.
image_paths : list
    A list of image paths corresponding to a specific split.</p>

<h2 id="returns">Returns:</h2>

<p>list
    A list of samples where each sample is a tuple (image_path, question, answer).</p>
</div>


                            </div>
                            <div id="DatasetBuilder._compute_max_question_len" class="classattr">
                                        <input id="DatasetBuilder._compute_max_question_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_compute_max_question_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">samples</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DatasetBuilder._compute_max_question_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder._compute_max_question_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder._compute_max_question_len-102"><a href="#DatasetBuilder._compute_max_question_len-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">_compute_max_question_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
</span><span id="DatasetBuilder._compute_max_question_len-103"><a href="#DatasetBuilder._compute_max_question_len-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._compute_max_question_len-104"><a href="#DatasetBuilder._compute_max_question_len-104"><span class="linenos">104</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder._compute_max_question_len-105"><a href="#DatasetBuilder._compute_max_question_len-105"><span class="linenos">105</span></a>
</span><span id="DatasetBuilder._compute_max_question_len-106"><a href="#DatasetBuilder._compute_max_question_len-106"><span class="linenos">106</span></a><span class="sd">        Computes the maximum length of questions in the dataset.</span>
</span><span id="DatasetBuilder._compute_max_question_len-107"><a href="#DatasetBuilder._compute_max_question_len-107"><span class="linenos">107</span></a>
</span><span id="DatasetBuilder._compute_max_question_len-108"><a href="#DatasetBuilder._compute_max_question_len-108"><span class="linenos">108</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder._compute_max_question_len-109"><a href="#DatasetBuilder._compute_max_question_len-109"><span class="linenos">109</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder._compute_max_question_len-110"><a href="#DatasetBuilder._compute_max_question_len-110"><span class="linenos">110</span></a><span class="sd">        samples : list</span>
</span><span id="DatasetBuilder._compute_max_question_len-111"><a href="#DatasetBuilder._compute_max_question_len-111"><span class="linenos">111</span></a><span class="sd">            A list of samples where each sample contains a question.</span>
</span><span id="DatasetBuilder._compute_max_question_len-112"><a href="#DatasetBuilder._compute_max_question_len-112"><span class="linenos">112</span></a>
</span><span id="DatasetBuilder._compute_max_question_len-113"><a href="#DatasetBuilder._compute_max_question_len-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder._compute_max_question_len-114"><a href="#DatasetBuilder._compute_max_question_len-114"><span class="linenos">114</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder._compute_max_question_len-115"><a href="#DatasetBuilder._compute_max_question_len-115"><span class="linenos">115</span></a><span class="sd">        int</span>
</span><span id="DatasetBuilder._compute_max_question_len-116"><a href="#DatasetBuilder._compute_max_question_len-116"><span class="linenos">116</span></a><span class="sd">            The length of the longest question in the dataset.</span>
</span><span id="DatasetBuilder._compute_max_question_len-117"><a href="#DatasetBuilder._compute_max_question_len-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._compute_max_question_len-118"><a href="#DatasetBuilder._compute_max_question_len-118"><span class="linenos">118</span></a>        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DatasetBuilder._compute_max_question_len-119"><a href="#DatasetBuilder._compute_max_question_len-119"><span class="linenos">119</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="DatasetBuilder._compute_max_question_len-120"><a href="#DatasetBuilder._compute_max_question_len-120"><span class="linenos">120</span></a>            <span class="n">question_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="DatasetBuilder._compute_max_question_len-121"><a href="#DatasetBuilder._compute_max_question_len-121"><span class="linenos">121</span></a>            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">question_len</span><span class="p">)</span>
</span><span id="DatasetBuilder._compute_max_question_len-122"><a href="#DatasetBuilder._compute_max_question_len-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="n">max_len</span>
</span></pre></div>


            <div class="docstring"><p>Computes the maximum length of questions in the dataset.</p>

<h2 id="parameters">Parameters:</h2>

<p>samples : list
    A list of samples where each sample contains a question.</p>

<h2 id="returns">Returns:</h2>

<p>int
    The length of the longest question in the dataset.</p>
</div>


                            </div>
                            <div id="DatasetBuilder._build_vocab" class="classattr">
                                        <input id="DatasetBuilder._build_vocab-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_build_vocab</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">samples</span>, </span><span class="param"><span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DatasetBuilder._build_vocab-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder._build_vocab"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder._build_vocab-124"><a href="#DatasetBuilder._build_vocab-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="nf">_build_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="DatasetBuilder._build_vocab-125"><a href="#DatasetBuilder._build_vocab-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._build_vocab-126"><a href="#DatasetBuilder._build_vocab-126"><span class="linenos">126</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder._build_vocab-127"><a href="#DatasetBuilder._build_vocab-127"><span class="linenos">127</span></a>
</span><span id="DatasetBuilder._build_vocab-128"><a href="#DatasetBuilder._build_vocab-128"><span class="linenos">128</span></a><span class="sd">        Builds a vocabulary from the dataset questions and assigns an index to each unique word.</span>
</span><span id="DatasetBuilder._build_vocab-129"><a href="#DatasetBuilder._build_vocab-129"><span class="linenos">129</span></a>
</span><span id="DatasetBuilder._build_vocab-130"><a href="#DatasetBuilder._build_vocab-130"><span class="linenos">130</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder._build_vocab-131"><a href="#DatasetBuilder._build_vocab-131"><span class="linenos">131</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder._build_vocab-132"><a href="#DatasetBuilder._build_vocab-132"><span class="linenos">132</span></a><span class="sd">        samples : list</span>
</span><span id="DatasetBuilder._build_vocab-133"><a href="#DatasetBuilder._build_vocab-133"><span class="linenos">133</span></a><span class="sd">            A list of samples where each sample contains a question.</span>
</span><span id="DatasetBuilder._build_vocab-134"><a href="#DatasetBuilder._build_vocab-134"><span class="linenos">134</span></a><span class="sd">        min_freq : int</span>
</span><span id="DatasetBuilder._build_vocab-135"><a href="#DatasetBuilder._build_vocab-135"><span class="linenos">135</span></a><span class="sd">            Minimum frequency for a word to be included in the vocabulary (default=1).</span>
</span><span id="DatasetBuilder._build_vocab-136"><a href="#DatasetBuilder._build_vocab-136"><span class="linenos">136</span></a>
</span><span id="DatasetBuilder._build_vocab-137"><a href="#DatasetBuilder._build_vocab-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder._build_vocab-138"><a href="#DatasetBuilder._build_vocab-138"><span class="linenos">138</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder._build_vocab-139"><a href="#DatasetBuilder._build_vocab-139"><span class="linenos">139</span></a><span class="sd">        dict</span>
</span><span id="DatasetBuilder._build_vocab-140"><a href="#DatasetBuilder._build_vocab-140"><span class="linenos">140</span></a><span class="sd">            A dictionary mapping each word to a unique index.</span>
</span><span id="DatasetBuilder._build_vocab-141"><a href="#DatasetBuilder._build_vocab-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._build_vocab-142"><a href="#DatasetBuilder._build_vocab-142"><span class="linenos">142</span></a>        <span class="n">word_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DatasetBuilder._build_vocab-143"><a href="#DatasetBuilder._build_vocab-143"><span class="linenos">143</span></a>
</span><span id="DatasetBuilder._build_vocab-144"><a href="#DatasetBuilder._build_vocab-144"><span class="linenos">144</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="DatasetBuilder._build_vocab-145"><a href="#DatasetBuilder._build_vocab-145"><span class="linenos">145</span></a>            <span class="n">word_counter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="DatasetBuilder._build_vocab-146"><a href="#DatasetBuilder._build_vocab-146"><span class="linenos">146</span></a>
</span><span id="DatasetBuilder._build_vocab-147"><a href="#DatasetBuilder._build_vocab-147"><span class="linenos">147</span></a>        <span class="n">vocab</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="DatasetBuilder._build_vocab-148"><a href="#DatasetBuilder._build_vocab-148"><span class="linenos">148</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">word_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DatasetBuilder._build_vocab-149"><a href="#DatasetBuilder._build_vocab-149"><span class="linenos">149</span></a>            <span class="k">if</span> <span class="n">freq</span> <span class="o">&gt;=</span> <span class="n">min_freq</span><span class="p">:</span>
</span><span id="DatasetBuilder._build_vocab-150"><a href="#DatasetBuilder._build_vocab-150"><span class="linenos">150</span></a>                <span class="n">vocab</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
</span><span id="DatasetBuilder._build_vocab-151"><a href="#DatasetBuilder._build_vocab-151"><span class="linenos">151</span></a>
</span><span id="DatasetBuilder._build_vocab-152"><a href="#DatasetBuilder._build_vocab-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="n">vocab</span>
</span></pre></div>


            <div class="docstring"><p>Builds a vocabulary from the dataset questions and assigns an index to each unique word.</p>

<h2 id="parameters">Parameters:</h2>

<p>samples : list
    A list of samples where each sample contains a question.
min_freq : int
    Minimum frequency for a word to be included in the vocabulary (default=1).</p>

<h2 id="returns">Returns:</h2>

<p>dict
    A dictionary mapping each word to a unique index.</p>
</div>


                            </div>
                            <div id="DatasetBuilder._build_answer_vocab" class="classattr">
                                        <input id="DatasetBuilder._build_answer_vocab-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_build_answer_vocab</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">samples</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DatasetBuilder._build_answer_vocab-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatasetBuilder._build_answer_vocab"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatasetBuilder._build_answer_vocab-154"><a href="#DatasetBuilder._build_answer_vocab-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">_build_answer_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
</span><span id="DatasetBuilder._build_answer_vocab-155"><a href="#DatasetBuilder._build_answer_vocab-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._build_answer_vocab-156"><a href="#DatasetBuilder._build_answer_vocab-156"><span class="linenos">156</span></a><span class="sd">        @public</span>
</span><span id="DatasetBuilder._build_answer_vocab-157"><a href="#DatasetBuilder._build_answer_vocab-157"><span class="linenos">157</span></a>
</span><span id="DatasetBuilder._build_answer_vocab-158"><a href="#DatasetBuilder._build_answer_vocab-158"><span class="linenos">158</span></a><span class="sd">        Builds a vocabulary from the dataset answers, mapping each answer to a unique index.</span>
</span><span id="DatasetBuilder._build_answer_vocab-159"><a href="#DatasetBuilder._build_answer_vocab-159"><span class="linenos">159</span></a>
</span><span id="DatasetBuilder._build_answer_vocab-160"><a href="#DatasetBuilder._build_answer_vocab-160"><span class="linenos">160</span></a><span class="sd">        Parameters:</span>
</span><span id="DatasetBuilder._build_answer_vocab-161"><a href="#DatasetBuilder._build_answer_vocab-161"><span class="linenos">161</span></a><span class="sd">        -----------</span>
</span><span id="DatasetBuilder._build_answer_vocab-162"><a href="#DatasetBuilder._build_answer_vocab-162"><span class="linenos">162</span></a><span class="sd">        samples : list</span>
</span><span id="DatasetBuilder._build_answer_vocab-163"><a href="#DatasetBuilder._build_answer_vocab-163"><span class="linenos">163</span></a><span class="sd">            A list of samples where each sample contains an answer.</span>
</span><span id="DatasetBuilder._build_answer_vocab-164"><a href="#DatasetBuilder._build_answer_vocab-164"><span class="linenos">164</span></a>
</span><span id="DatasetBuilder._build_answer_vocab-165"><a href="#DatasetBuilder._build_answer_vocab-165"><span class="linenos">165</span></a><span class="sd">        Returns:</span>
</span><span id="DatasetBuilder._build_answer_vocab-166"><a href="#DatasetBuilder._build_answer_vocab-166"><span class="linenos">166</span></a><span class="sd">        --------</span>
</span><span id="DatasetBuilder._build_answer_vocab-167"><a href="#DatasetBuilder._build_answer_vocab-167"><span class="linenos">167</span></a><span class="sd">        dict</span>
</span><span id="DatasetBuilder._build_answer_vocab-168"><a href="#DatasetBuilder._build_answer_vocab-168"><span class="linenos">168</span></a><span class="sd">            A dictionary mapping each answer to a unique index.</span>
</span><span id="DatasetBuilder._build_answer_vocab-169"><a href="#DatasetBuilder._build_answer_vocab-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatasetBuilder._build_answer_vocab-170"><a href="#DatasetBuilder._build_answer_vocab-170"><span class="linenos">170</span></a>        <span class="n">answer_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DatasetBuilder._build_answer_vocab-171"><a href="#DatasetBuilder._build_answer_vocab-171"><span class="linenos">171</span></a>
</span><span id="DatasetBuilder._build_answer_vocab-172"><a href="#DatasetBuilder._build_answer_vocab-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="DatasetBuilder._build_answer_vocab-173"><a href="#DatasetBuilder._build_answer_vocab-173"><span class="linenos">173</span></a>            <span class="n">answer_counter</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">answer</span><span class="p">])</span>
</span><span id="DatasetBuilder._build_answer_vocab-174"><a href="#DatasetBuilder._build_answer_vocab-174"><span class="linenos">174</span></a>
</span><span id="DatasetBuilder._build_answer_vocab-175"><a href="#DatasetBuilder._build_answer_vocab-175"><span class="linenos">175</span></a>        <span class="n">answer_vocab</span> <span class="o">=</span> <span class="p">{</span><span class="n">ans</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ans</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">answer_counter</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
</span><span id="DatasetBuilder._build_answer_vocab-176"><a href="#DatasetBuilder._build_answer_vocab-176"><span class="linenos">176</span></a>
</span><span id="DatasetBuilder._build_answer_vocab-177"><a href="#DatasetBuilder._build_answer_vocab-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="n">answer_vocab</span>
</span></pre></div>


            <div class="docstring"><p>Builds a vocabulary from the dataset answers, mapping each answer to a unique index.</p>

<h2 id="parameters">Parameters:</h2>

<p>samples : list
    A list of samples where each sample contains an answer.</p>

<h2 id="returns">Returns:</h2>

<p>dict
    A dictionary mapping each answer to a unique index.</p>
</div>


                            </div>
                </section>
                <section id="RelationalDataset">
                            <input id="RelationalDataset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RelationalDataset</span><wbr>(<span class="base">typing.Generic[+T_co]</span>):

                <label class="view-source-button" for="RelationalDataset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationalDataset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationalDataset-179"><a href="#RelationalDataset-179"><span class="linenos">179</span></a><span class="k">class</span> <span class="nc">RelationalDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
</span><span id="RelationalDataset-180"><a href="#RelationalDataset-180"><span class="linenos">180</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationalDataset-181"><a href="#RelationalDataset-181"><span class="linenos">181</span></a><span class="sd">    A PyTorch Dataset class to load relational reasoning data, including both relational </span>
</span><span id="RelationalDataset-182"><a href="#RelationalDataset-182"><span class="linenos">182</span></a><span class="sd">    and non-relational questions. Supports data augmentation and train/val/test splitting.</span>
</span><span id="RelationalDataset-183"><a href="#RelationalDataset-183"><span class="linenos">183</span></a>
</span><span id="RelationalDataset-184"><a href="#RelationalDataset-184"><span class="linenos">184</span></a><span class="sd">    Attributes:</span>
</span><span id="RelationalDataset-185"><a href="#RelationalDataset-185"><span class="linenos">185</span></a><span class="sd">    -----------</span>
</span><span id="RelationalDataset-186"><a href="#RelationalDataset-186"><span class="linenos">186</span></a><span class="sd">    samples : list</span>
</span><span id="RelationalDataset-187"><a href="#RelationalDataset-187"><span class="linenos">187</span></a><span class="sd">        The dataset samples with image paths, questions, and answers.</span>
</span><span id="RelationalDataset-188"><a href="#RelationalDataset-188"><span class="linenos">188</span></a><span class="sd">    vocab : dict</span>
</span><span id="RelationalDataset-189"><a href="#RelationalDataset-189"><span class="linenos">189</span></a><span class="sd">        A dictionary mapping question words to token indices.</span>
</span><span id="RelationalDataset-190"><a href="#RelationalDataset-190"><span class="linenos">190</span></a><span class="sd">    answer_vocab : dict</span>
</span><span id="RelationalDataset-191"><a href="#RelationalDataset-191"><span class="linenos">191</span></a><span class="sd">        A dictionary mapping answers to token indices.</span>
</span><span id="RelationalDataset-192"><a href="#RelationalDataset-192"><span class="linenos">192</span></a><span class="sd">    max_len : int</span>
</span><span id="RelationalDataset-193"><a href="#RelationalDataset-193"><span class="linenos">193</span></a><span class="sd">        The maximum length of tokenized questions for padding.</span>
</span><span id="RelationalDataset-194"><a href="#RelationalDataset-194"><span class="linenos">194</span></a><span class="sd">    transform : ImageAnswerTransform</span>
</span><span id="RelationalDataset-195"><a href="#RelationalDataset-195"><span class="linenos">195</span></a><span class="sd">        Data transformations that apply both image and text transformations.</span>
</span><span id="RelationalDataset-196"><a href="#RelationalDataset-196"><span class="linenos">196</span></a><span class="sd">    transform_prob : float</span>
</span><span id="RelationalDataset-197"><a href="#RelationalDataset-197"><span class="linenos">197</span></a><span class="sd">        The probability of applying transformations.        </span>
</span><span id="RelationalDataset-198"><a href="#RelationalDataset-198"><span class="linenos">198</span></a><span class="sd">    random_seed : int</span>
</span><span id="RelationalDataset-199"><a href="#RelationalDataset-199"><span class="linenos">199</span></a><span class="sd">        Random seed for reproducibility and for use in transformations.</span>
</span><span id="RelationalDataset-200"><a href="#RelationalDataset-200"><span class="linenos">200</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RelationalDataset-201"><a href="#RelationalDataset-201"><span class="linenos">201</span></a>
</span><span id="RelationalDataset-202"><a href="#RelationalDataset-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">answer_vocab</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
</span><span id="RelationalDataset-203"><a href="#RelationalDataset-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="RelationalDataset-204"><a href="#RelationalDataset-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
</span><span id="RelationalDataset-205"><a href="#RelationalDataset-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span> <span class="o">=</span> <span class="n">answer_vocab</span>
</span><span id="RelationalDataset-206"><a href="#RelationalDataset-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="n">max_len</span>
</span><span id="RelationalDataset-207"><a href="#RelationalDataset-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
</span><span id="RelationalDataset-208"><a href="#RelationalDataset-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span> <span class="o">=</span> <span class="n">transform_prob</span>        
</span><span id="RelationalDataset-209"><a href="#RelationalDataset-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="RelationalDataset-210"><a href="#RelationalDataset-210"><span class="linenos">210</span></a>
</span><span id="RelationalDataset-211"><a href="#RelationalDataset-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RelationalDataset-212"><a href="#RelationalDataset-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>
</span><span id="RelationalDataset-213"><a href="#RelationalDataset-213"><span class="linenos">213</span></a>
</span><span id="RelationalDataset-214"><a href="#RelationalDataset-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span><span id="RelationalDataset-215"><a href="#RelationalDataset-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationalDataset-216"><a href="#RelationalDataset-216"><span class="linenos">216</span></a><span class="sd">        Fetch an image and its corresponding tokenized question-answer pair, applying the appropriate transformations.</span>
</span><span id="RelationalDataset-217"><a href="#RelationalDataset-217"><span class="linenos">217</span></a>
</span><span id="RelationalDataset-218"><a href="#RelationalDataset-218"><span class="linenos">218</span></a><span class="sd">        Returns:</span>
</span><span id="RelationalDataset-219"><a href="#RelationalDataset-219"><span class="linenos">219</span></a><span class="sd">        --------</span>
</span><span id="RelationalDataset-220"><a href="#RelationalDataset-220"><span class="linenos">220</span></a><span class="sd">        tuple</span>
</span><span id="RelationalDataset-221"><a href="#RelationalDataset-221"><span class="linenos">221</span></a><span class="sd">            A tuple (image, tokenized_question, encoded_answer) where image is a transformed image tensor, </span>
</span><span id="RelationalDataset-222"><a href="#RelationalDataset-222"><span class="linenos">222</span></a><span class="sd">            tokenized_question is a list of token indices, and encoded_answer is an integer index.</span>
</span><span id="RelationalDataset-223"><a href="#RelationalDataset-223"><span class="linenos">223</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationalDataset-224"><a href="#RelationalDataset-224"><span class="linenos">224</span></a>        <span class="n">image_path</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="RelationalDataset-225"><a href="#RelationalDataset-225"><span class="linenos">225</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
</span><span id="RelationalDataset-226"><a href="#RelationalDataset-226"><span class="linenos">226</span></a>
</span><span id="RelationalDataset-227"><a href="#RelationalDataset-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span><span class="p">:</span>
</span><span id="RelationalDataset-228"><a href="#RelationalDataset-228"><span class="linenos">228</span></a>            <span class="n">img</span><span class="p">,</span> <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
</span><span id="RelationalDataset-229"><a href="#RelationalDataset-229"><span class="linenos">229</span></a>
</span><span id="RelationalDataset-230"><a href="#RelationalDataset-230"><span class="linenos">230</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()(</span><span class="n">img</span><span class="p">)</span>
</span><span id="RelationalDataset-231"><a href="#RelationalDataset-231"><span class="linenos">231</span></a>        <span class="n">tokenized_question</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_question</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span><span id="RelationalDataset-232"><a href="#RelationalDataset-232"><span class="linenos">232</span></a>        <span class="n">encoded_answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_answer</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span><span id="RelationalDataset-233"><a href="#RelationalDataset-233"><span class="linenos">233</span></a>
</span><span id="RelationalDataset-234"><a href="#RelationalDataset-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">tokenized_question</span><span class="p">,</span> <span class="n">encoded_answer</span>
</span><span id="RelationalDataset-235"><a href="#RelationalDataset-235"><span class="linenos">235</span></a>
</span><span id="RelationalDataset-236"><a href="#RelationalDataset-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">_tokenize_question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">):</span>
</span><span id="RelationalDataset-237"><a href="#RelationalDataset-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationalDataset-238"><a href="#RelationalDataset-238"><span class="linenos">238</span></a><span class="sd">        @public</span>
</span><span id="RelationalDataset-239"><a href="#RelationalDataset-239"><span class="linenos">239</span></a>
</span><span id="RelationalDataset-240"><a href="#RelationalDataset-240"><span class="linenos">240</span></a><span class="sd">        Tokenizes the question into a list of token indices and pads or truncates to max_len.</span>
</span><span id="RelationalDataset-241"><a href="#RelationalDataset-241"><span class="linenos">241</span></a>
</span><span id="RelationalDataset-242"><a href="#RelationalDataset-242"><span class="linenos">242</span></a><span class="sd">        Parameters:</span>
</span><span id="RelationalDataset-243"><a href="#RelationalDataset-243"><span class="linenos">243</span></a><span class="sd">        -----------</span>
</span><span id="RelationalDataset-244"><a href="#RelationalDataset-244"><span class="linenos">244</span></a><span class="sd">        question : str</span>
</span><span id="RelationalDataset-245"><a href="#RelationalDataset-245"><span class="linenos">245</span></a><span class="sd">            The question to tokenize.</span>
</span><span id="RelationalDataset-246"><a href="#RelationalDataset-246"><span class="linenos">246</span></a>
</span><span id="RelationalDataset-247"><a href="#RelationalDataset-247"><span class="linenos">247</span></a><span class="sd">        Returns:</span>
</span><span id="RelationalDataset-248"><a href="#RelationalDataset-248"><span class="linenos">248</span></a><span class="sd">        --------</span>
</span><span id="RelationalDataset-249"><a href="#RelationalDataset-249"><span class="linenos">249</span></a><span class="sd">        list</span>
</span><span id="RelationalDataset-250"><a href="#RelationalDataset-250"><span class="linenos">250</span></a><span class="sd">            A list of token indices.</span>
</span><span id="RelationalDataset-251"><a href="#RelationalDataset-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationalDataset-252"><a href="#RelationalDataset-252"><span class="linenos">252</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">question</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="RelationalDataset-253"><a href="#RelationalDataset-253"><span class="linenos">253</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">]</span>  <span class="c1"># truncate if longer than max_len</span>
</span><span id="RelationalDataset-254"><a href="#RelationalDataset-254"><span class="linenos">254</span></a>        <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>  <span class="c1"># pad if shorter than max_len</span>
</span><span id="RelationalDataset-255"><a href="#RelationalDataset-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="n">tokens</span>
</span><span id="RelationalDataset-256"><a href="#RelationalDataset-256"><span class="linenos">256</span></a>
</span><span id="RelationalDataset-257"><a href="#RelationalDataset-257"><span class="linenos">257</span></a>    <span class="k">def</span> <span class="nf">_encode_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
</span><span id="RelationalDataset-258"><a href="#RelationalDataset-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationalDataset-259"><a href="#RelationalDataset-259"><span class="linenos">259</span></a><span class="sd">        @public</span>
</span><span id="RelationalDataset-260"><a href="#RelationalDataset-260"><span class="linenos">260</span></a>
</span><span id="RelationalDataset-261"><a href="#RelationalDataset-261"><span class="linenos">261</span></a><span class="sd">        Converts an answer into its corresponding index.</span>
</span><span id="RelationalDataset-262"><a href="#RelationalDataset-262"><span class="linenos">262</span></a>
</span><span id="RelationalDataset-263"><a href="#RelationalDataset-263"><span class="linenos">263</span></a><span class="sd">        Parameters:</span>
</span><span id="RelationalDataset-264"><a href="#RelationalDataset-264"><span class="linenos">264</span></a><span class="sd">        -----------</span>
</span><span id="RelationalDataset-265"><a href="#RelationalDataset-265"><span class="linenos">265</span></a><span class="sd">        answer : str</span>
</span><span id="RelationalDataset-266"><a href="#RelationalDataset-266"><span class="linenos">266</span></a><span class="sd">            The answer to encode.</span>
</span><span id="RelationalDataset-267"><a href="#RelationalDataset-267"><span class="linenos">267</span></a><span class="sd">        answer_vocab : dict</span>
</span><span id="RelationalDataset-268"><a href="#RelationalDataset-268"><span class="linenos">268</span></a><span class="sd">            A dictionary mapping answers to indices.</span>
</span><span id="RelationalDataset-269"><a href="#RelationalDataset-269"><span class="linenos">269</span></a>
</span><span id="RelationalDataset-270"><a href="#RelationalDataset-270"><span class="linenos">270</span></a><span class="sd">        Returns:</span>
</span><span id="RelationalDataset-271"><a href="#RelationalDataset-271"><span class="linenos">271</span></a><span class="sd">        --------</span>
</span><span id="RelationalDataset-272"><a href="#RelationalDataset-272"><span class="linenos">272</span></a><span class="sd">        int</span>
</span><span id="RelationalDataset-273"><a href="#RelationalDataset-273"><span class="linenos">273</span></a><span class="sd">            The index of the answer in the answer vocabulary.</span>
</span><span id="RelationalDataset-274"><a href="#RelationalDataset-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationalDataset-275"><a href="#RelationalDataset-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">[</span><span class="n">answer</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A PyTorch Dataset class to load relational reasoning data, including both relational 
and non-relational questions. Supports data augmentation and train/val/test splitting.</p>

<h2 id="attributes">Attributes:</h2>

<p>samples : list
    The dataset samples with image paths, questions, and answers.
vocab : dict
    A dictionary mapping question words to token indices.
answer_vocab : dict
    A dictionary mapping answers to token indices.
max_len : int
    The maximum length of tokenized questions for padding.
transform : ImageAnswerTransform
    Data transformations that apply both image and text transformations.
transform_prob : float
    The probability of applying transformations.<br />
random_seed : int
    Random seed for reproducibility and for use in transformations.</p>
</div>


                            <div id="RelationalDataset.__init__" class="classattr">
                                        <input id="RelationalDataset.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RelationalDataset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">samples</span>,</span><span class="param">	<span class="n">vocab</span>,</span><span class="param">	<span class="n">answer_vocab</span>,</span><span class="param">	<span class="n">max_len</span>,</span><span class="param">	<span class="n">transform</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span></span>)</span>

                <label class="view-source-button" for="RelationalDataset.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationalDataset.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationalDataset.__init__-202"><a href="#RelationalDataset.__init__-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">answer_vocab</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
</span><span id="RelationalDataset.__init__-203"><a href="#RelationalDataset.__init__-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="RelationalDataset.__init__-204"><a href="#RelationalDataset.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
</span><span id="RelationalDataset.__init__-205"><a href="#RelationalDataset.__init__-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span> <span class="o">=</span> <span class="n">answer_vocab</span>
</span><span id="RelationalDataset.__init__-206"><a href="#RelationalDataset.__init__-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="n">max_len</span>
</span><span id="RelationalDataset.__init__-207"><a href="#RelationalDataset.__init__-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
</span><span id="RelationalDataset.__init__-208"><a href="#RelationalDataset.__init__-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_prob</span> <span class="o">=</span> <span class="n">transform_prob</span>        
</span><span id="RelationalDataset.__init__-209"><a href="#RelationalDataset.__init__-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
</span></pre></div>


    

                            </div>
                            <div id="RelationalDataset.samples" class="classattr">
                                <div class="attr variable">
            <span class="name">samples</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.samples"></a>
    
    

                            </div>
                            <div id="RelationalDataset.vocab" class="classattr">
                                <div class="attr variable">
            <span class="name">vocab</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.vocab"></a>
    
    

                            </div>
                            <div id="RelationalDataset.answer_vocab" class="classattr">
                                <div class="attr variable">
            <span class="name">answer_vocab</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.answer_vocab"></a>
    
    

                            </div>
                            <div id="RelationalDataset.max_len" class="classattr">
                                <div class="attr variable">
            <span class="name">max_len</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.max_len"></a>
    
    

                            </div>
                            <div id="RelationalDataset.transform" class="classattr">
                                <div class="attr variable">
            <span class="name">transform</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.transform"></a>
    
    

                            </div>
                            <div id="RelationalDataset.transform_prob" class="classattr">
                                <div class="attr variable">
            <span class="name">transform_prob</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.transform_prob"></a>
    
    

                            </div>
                            <div id="RelationalDataset.random_seed" class="classattr">
                                <div class="attr variable">
            <span class="name">random_seed</span>

        
    </div>
    <a class="headerlink" href="#RelationalDataset.random_seed"></a>
    
    

                            </div>
                            <div id="RelationalDataset._tokenize_question" class="classattr">
                                        <input id="RelationalDataset._tokenize_question-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_tokenize_question</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">question</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RelationalDataset._tokenize_question-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationalDataset._tokenize_question"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationalDataset._tokenize_question-236"><a href="#RelationalDataset._tokenize_question-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">_tokenize_question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">):</span>
</span><span id="RelationalDataset._tokenize_question-237"><a href="#RelationalDataset._tokenize_question-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationalDataset._tokenize_question-238"><a href="#RelationalDataset._tokenize_question-238"><span class="linenos">238</span></a><span class="sd">        @public</span>
</span><span id="RelationalDataset._tokenize_question-239"><a href="#RelationalDataset._tokenize_question-239"><span class="linenos">239</span></a>
</span><span id="RelationalDataset._tokenize_question-240"><a href="#RelationalDataset._tokenize_question-240"><span class="linenos">240</span></a><span class="sd">        Tokenizes the question into a list of token indices and pads or truncates to max_len.</span>
</span><span id="RelationalDataset._tokenize_question-241"><a href="#RelationalDataset._tokenize_question-241"><span class="linenos">241</span></a>
</span><span id="RelationalDataset._tokenize_question-242"><a href="#RelationalDataset._tokenize_question-242"><span class="linenos">242</span></a><span class="sd">        Parameters:</span>
</span><span id="RelationalDataset._tokenize_question-243"><a href="#RelationalDataset._tokenize_question-243"><span class="linenos">243</span></a><span class="sd">        -----------</span>
</span><span id="RelationalDataset._tokenize_question-244"><a href="#RelationalDataset._tokenize_question-244"><span class="linenos">244</span></a><span class="sd">        question : str</span>
</span><span id="RelationalDataset._tokenize_question-245"><a href="#RelationalDataset._tokenize_question-245"><span class="linenos">245</span></a><span class="sd">            The question to tokenize.</span>
</span><span id="RelationalDataset._tokenize_question-246"><a href="#RelationalDataset._tokenize_question-246"><span class="linenos">246</span></a>
</span><span id="RelationalDataset._tokenize_question-247"><a href="#RelationalDataset._tokenize_question-247"><span class="linenos">247</span></a><span class="sd">        Returns:</span>
</span><span id="RelationalDataset._tokenize_question-248"><a href="#RelationalDataset._tokenize_question-248"><span class="linenos">248</span></a><span class="sd">        --------</span>
</span><span id="RelationalDataset._tokenize_question-249"><a href="#RelationalDataset._tokenize_question-249"><span class="linenos">249</span></a><span class="sd">        list</span>
</span><span id="RelationalDataset._tokenize_question-250"><a href="#RelationalDataset._tokenize_question-250"><span class="linenos">250</span></a><span class="sd">            A list of token indices.</span>
</span><span id="RelationalDataset._tokenize_question-251"><a href="#RelationalDataset._tokenize_question-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationalDataset._tokenize_question-252"><a href="#RelationalDataset._tokenize_question-252"><span class="linenos">252</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">question</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="RelationalDataset._tokenize_question-253"><a href="#RelationalDataset._tokenize_question-253"><span class="linenos">253</span></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">max_len</span><span class="p">]</span>  <span class="c1"># truncate if longer than max_len</span>
</span><span id="RelationalDataset._tokenize_question-254"><a href="#RelationalDataset._tokenize_question-254"><span class="linenos">254</span></a>        <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>  <span class="c1"># pad if shorter than max_len</span>
</span><span id="RelationalDataset._tokenize_question-255"><a href="#RelationalDataset._tokenize_question-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="n">tokens</span>
</span></pre></div>


            <div class="docstring"><p>Tokenizes the question into a list of token indices and pads or truncates to max_len.</p>

<h2 id="parameters">Parameters:</h2>

<p>question : str
    The question to tokenize.</p>

<h2 id="returns">Returns:</h2>

<p>list
    A list of token indices.</p>
</div>


                            </div>
                            <div id="RelationalDataset._encode_answer" class="classattr">
                                        <input id="RelationalDataset._encode_answer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_encode_answer</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">answer</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RelationalDataset._encode_answer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationalDataset._encode_answer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationalDataset._encode_answer-257"><a href="#RelationalDataset._encode_answer-257"><span class="linenos">257</span></a>    <span class="k">def</span> <span class="nf">_encode_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
</span><span id="RelationalDataset._encode_answer-258"><a href="#RelationalDataset._encode_answer-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationalDataset._encode_answer-259"><a href="#RelationalDataset._encode_answer-259"><span class="linenos">259</span></a><span class="sd">        @public</span>
</span><span id="RelationalDataset._encode_answer-260"><a href="#RelationalDataset._encode_answer-260"><span class="linenos">260</span></a>
</span><span id="RelationalDataset._encode_answer-261"><a href="#RelationalDataset._encode_answer-261"><span class="linenos">261</span></a><span class="sd">        Converts an answer into its corresponding index.</span>
</span><span id="RelationalDataset._encode_answer-262"><a href="#RelationalDataset._encode_answer-262"><span class="linenos">262</span></a>
</span><span id="RelationalDataset._encode_answer-263"><a href="#RelationalDataset._encode_answer-263"><span class="linenos">263</span></a><span class="sd">        Parameters:</span>
</span><span id="RelationalDataset._encode_answer-264"><a href="#RelationalDataset._encode_answer-264"><span class="linenos">264</span></a><span class="sd">        -----------</span>
</span><span id="RelationalDataset._encode_answer-265"><a href="#RelationalDataset._encode_answer-265"><span class="linenos">265</span></a><span class="sd">        answer : str</span>
</span><span id="RelationalDataset._encode_answer-266"><a href="#RelationalDataset._encode_answer-266"><span class="linenos">266</span></a><span class="sd">            The answer to encode.</span>
</span><span id="RelationalDataset._encode_answer-267"><a href="#RelationalDataset._encode_answer-267"><span class="linenos">267</span></a><span class="sd">        answer_vocab : dict</span>
</span><span id="RelationalDataset._encode_answer-268"><a href="#RelationalDataset._encode_answer-268"><span class="linenos">268</span></a><span class="sd">            A dictionary mapping answers to indices.</span>
</span><span id="RelationalDataset._encode_answer-269"><a href="#RelationalDataset._encode_answer-269"><span class="linenos">269</span></a>
</span><span id="RelationalDataset._encode_answer-270"><a href="#RelationalDataset._encode_answer-270"><span class="linenos">270</span></a><span class="sd">        Returns:</span>
</span><span id="RelationalDataset._encode_answer-271"><a href="#RelationalDataset._encode_answer-271"><span class="linenos">271</span></a><span class="sd">        --------</span>
</span><span id="RelationalDataset._encode_answer-272"><a href="#RelationalDataset._encode_answer-272"><span class="linenos">272</span></a><span class="sd">        int</span>
</span><span id="RelationalDataset._encode_answer-273"><a href="#RelationalDataset._encode_answer-273"><span class="linenos">273</span></a><span class="sd">            The index of the answer in the answer vocabulary.</span>
</span><span id="RelationalDataset._encode_answer-274"><a href="#RelationalDataset._encode_answer-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationalDataset._encode_answer-275"><a href="#RelationalDataset._encode_answer-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_vocab</span><span class="p">[</span><span class="n">answer</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Converts an answer into its corresponding index.</p>

<h2 id="parameters">Parameters:</h2>

<p>answer : str
    The answer to encode.
answer_vocab : dict
    A dictionary mapping answers to indices.</p>

<h2 id="returns">Returns:</h2>

<p>int
    The index of the answer in the answer vocabulary.</p>
</div>


                            </div>
                </section>
                <section id="ImageAnswerTransform">
                            <input id="ImageAnswerTransform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ImageAnswerTransform</span>:

                <label class="view-source-button" for="ImageAnswerTransform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImageAnswerTransform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImageAnswerTransform-277"><a href="#ImageAnswerTransform-277"><span class="linenos">277</span></a><span class="k">class</span> <span class="nc">ImageAnswerTransform</span><span class="p">:</span>
</span><span id="ImageAnswerTransform-278"><a href="#ImageAnswerTransform-278"><span class="linenos">278</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImageAnswerTransform-279"><a href="#ImageAnswerTransform-279"><span class="linenos">279</span></a><span class="sd">    A class that applies both image and text transformations, allowing </span>
</span><span id="ImageAnswerTransform-280"><a href="#ImageAnswerTransform-280"><span class="linenos">280</span></a><span class="sd">    them to communicate via a shared state. The state can be used to </span>
</span><span id="ImageAnswerTransform-281"><a href="#ImageAnswerTransform-281"><span class="linenos">281</span></a><span class="sd">    pass transformation parameters or results from the image transformation </span>
</span><span id="ImageAnswerTransform-282"><a href="#ImageAnswerTransform-282"><span class="linenos">282</span></a><span class="sd">    to the text transformation, allowing for coordinated changes between </span>
</span><span id="ImageAnswerTransform-283"><a href="#ImageAnswerTransform-283"><span class="linenos">283</span></a><span class="sd">    the image and the label.</span>
</span><span id="ImageAnswerTransform-284"><a href="#ImageAnswerTransform-284"><span class="linenos">284</span></a>
</span><span id="ImageAnswerTransform-285"><a href="#ImageAnswerTransform-285"><span class="linenos">285</span></a><span class="sd">    Attributes:</span>
</span><span id="ImageAnswerTransform-286"><a href="#ImageAnswerTransform-286"><span class="linenos">286</span></a><span class="sd">    -----------</span>
</span><span id="ImageAnswerTransform-287"><a href="#ImageAnswerTransform-287"><span class="linenos">287</span></a><span class="sd">    image_transform : callable, optional</span>
</span><span id="ImageAnswerTransform-288"><a href="#ImageAnswerTransform-288"><span class="linenos">288</span></a><span class="sd">        A transformation function for the image. It should accept a PIL Image </span>
</span><span id="ImageAnswerTransform-289"><a href="#ImageAnswerTransform-289"><span class="linenos">289</span></a><span class="sd">        and a state dictionary, then return the transformed PIL Image and the updated state.</span>
</span><span id="ImageAnswerTransform-290"><a href="#ImageAnswerTransform-290"><span class="linenos">290</span></a><span class="sd">        </span>
</span><span id="ImageAnswerTransform-291"><a href="#ImageAnswerTransform-291"><span class="linenos">291</span></a><span class="sd">    text_transform : callable, optional</span>
</span><span id="ImageAnswerTransform-292"><a href="#ImageAnswerTransform-292"><span class="linenos">292</span></a><span class="sd">        A transformation function for the label (string). It should accept a string label </span>
</span><span id="ImageAnswerTransform-293"><a href="#ImageAnswerTransform-293"><span class="linenos">293</span></a><span class="sd">        and the shared state, then return the transformed label.</span>
</span><span id="ImageAnswerTransform-294"><a href="#ImageAnswerTransform-294"><span class="linenos">294</span></a><span class="sd">        </span>
</span><span id="ImageAnswerTransform-295"><a href="#ImageAnswerTransform-295"><span class="linenos">295</span></a><span class="sd">    state : dict, optional</span>
</span><span id="ImageAnswerTransform-296"><a href="#ImageAnswerTransform-296"><span class="linenos">296</span></a><span class="sd">        A shared state dictionary used to pass information between the image </span>
</span><span id="ImageAnswerTransform-297"><a href="#ImageAnswerTransform-297"><span class="linenos">297</span></a><span class="sd">        and text transformations. If not provided, it is initialized as an empty dictionary.</span>
</span><span id="ImageAnswerTransform-298"><a href="#ImageAnswerTransform-298"><span class="linenos">298</span></a>
</span><span id="ImageAnswerTransform-299"><a href="#ImageAnswerTransform-299"><span class="linenos">299</span></a><span class="sd">    Methods:</span>
</span><span id="ImageAnswerTransform-300"><a href="#ImageAnswerTransform-300"><span class="linenos">300</span></a><span class="sd">    --------</span>
</span><span id="ImageAnswerTransform-301"><a href="#ImageAnswerTransform-301"><span class="linenos">301</span></a><span class="sd">    __call__(img, label)</span>
</span><span id="ImageAnswerTransform-302"><a href="#ImageAnswerTransform-302"><span class="linenos">302</span></a><span class="sd">        Applies the image transformation, updates the shared state, and then </span>
</span><span id="ImageAnswerTransform-303"><a href="#ImageAnswerTransform-303"><span class="linenos">303</span></a><span class="sd">        applies the text transformation using the updated state.</span>
</span><span id="ImageAnswerTransform-304"><a href="#ImageAnswerTransform-304"><span class="linenos">304</span></a>
</span><span id="ImageAnswerTransform-305"><a href="#ImageAnswerTransform-305"><span class="linenos">305</span></a><span class="sd">        Parameters:</span>
</span><span id="ImageAnswerTransform-306"><a href="#ImageAnswerTransform-306"><span class="linenos">306</span></a><span class="sd">        -----------</span>
</span><span id="ImageAnswerTransform-307"><a href="#ImageAnswerTransform-307"><span class="linenos">307</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="ImageAnswerTransform-308"><a href="#ImageAnswerTransform-308"><span class="linenos">308</span></a><span class="sd">            The input image to be transformed.</span>
</span><span id="ImageAnswerTransform-309"><a href="#ImageAnswerTransform-309"><span class="linenos">309</span></a><span class="sd">            </span>
</span><span id="ImageAnswerTransform-310"><a href="#ImageAnswerTransform-310"><span class="linenos">310</span></a><span class="sd">        label : str</span>
</span><span id="ImageAnswerTransform-311"><a href="#ImageAnswerTransform-311"><span class="linenos">311</span></a><span class="sd">            The label associated with the image, which may be transformed </span>
</span><span id="ImageAnswerTransform-312"><a href="#ImageAnswerTransform-312"><span class="linenos">312</span></a><span class="sd">            based on the shared state.</span>
</span><span id="ImageAnswerTransform-313"><a href="#ImageAnswerTransform-313"><span class="linenos">313</span></a>
</span><span id="ImageAnswerTransform-314"><a href="#ImageAnswerTransform-314"><span class="linenos">314</span></a><span class="sd">        Returns:</span>
</span><span id="ImageAnswerTransform-315"><a href="#ImageAnswerTransform-315"><span class="linenos">315</span></a><span class="sd">        --------</span>
</span><span id="ImageAnswerTransform-316"><a href="#ImageAnswerTransform-316"><span class="linenos">316</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="ImageAnswerTransform-317"><a href="#ImageAnswerTransform-317"><span class="linenos">317</span></a><span class="sd">            The transformed image.</span>
</span><span id="ImageAnswerTransform-318"><a href="#ImageAnswerTransform-318"><span class="linenos">318</span></a>
</span><span id="ImageAnswerTransform-319"><a href="#ImageAnswerTransform-319"><span class="linenos">319</span></a><span class="sd">        label : str</span>
</span><span id="ImageAnswerTransform-320"><a href="#ImageAnswerTransform-320"><span class="linenos">320</span></a><span class="sd">            The transformed label, modified based on the image transformation </span>
</span><span id="ImageAnswerTransform-321"><a href="#ImageAnswerTransform-321"><span class="linenos">321</span></a><span class="sd">            and the state.</span>
</span><span id="ImageAnswerTransform-322"><a href="#ImageAnswerTransform-322"><span class="linenos">322</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ImageAnswerTransform-323"><a href="#ImageAnswerTransform-323"><span class="linenos">323</span></a>
</span><span id="ImageAnswerTransform-324"><a href="#ImageAnswerTransform-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ImageAnswerTransform-325"><a href="#ImageAnswerTransform-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span> <span class="o">=</span> <span class="n">image_transform</span>
</span><span id="ImageAnswerTransform-326"><a href="#ImageAnswerTransform-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">text_transform</span>
</span><span id="ImageAnswerTransform-327"><a href="#ImageAnswerTransform-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="ImageAnswerTransform-328"><a href="#ImageAnswerTransform-328"><span class="linenos">328</span></a>
</span><span id="ImageAnswerTransform-329"><a href="#ImageAnswerTransform-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
</span><span id="ImageAnswerTransform-330"><a href="#ImageAnswerTransform-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span><span class="p">:</span>
</span><span id="ImageAnswerTransform-331"><a href="#ImageAnswerTransform-331"><span class="linenos">331</span></a>            <span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="ImageAnswerTransform-332"><a href="#ImageAnswerTransform-332"><span class="linenos">332</span></a>
</span><span id="ImageAnswerTransform-333"><a href="#ImageAnswerTransform-333"><span class="linenos">333</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span><span class="p">:</span>
</span><span id="ImageAnswerTransform-334"><a href="#ImageAnswerTransform-334"><span class="linenos">334</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="ImageAnswerTransform-335"><a href="#ImageAnswerTransform-335"><span class="linenos">335</span></a>
</span><span id="ImageAnswerTransform-336"><a href="#ImageAnswerTransform-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">label</span>
</span></pre></div>


            <div class="docstring"><p>A class that applies both image and text transformations, allowing 
them to communicate via a shared state. The state can be used to 
pass transformation parameters or results from the image transformation 
to the text transformation, allowing for coordinated changes between 
the image and the label.</p>

<h2 id="attributes">Attributes:</h2>

<p>image_transform : callable, optional
    A transformation function for the image. It should accept a PIL Image 
    and a state dictionary, then return the transformed PIL Image and the updated state.</p>

<p>text_transform : callable, optional
    A transformation function for the label (string). It should accept a string label 
    and the shared state, then return the transformed label.</p>

<p>state : dict, optional
    A shared state dictionary used to pass information between the image 
    and text transformations. If not provided, it is initialized as an empty dictionary.</p>

<h2 id="methods">Methods:</h2>

<p>__call__(img, label)
    Applies the image transformation, updates the shared state, and then 
    applies the text transformation using the updated state.</p>

<pre><code>Parameters:
-----------
img : PIL.Image
    The input image to be transformed.

label : str
    The label associated with the image, which may be transformed 
    based on the shared state.

Returns:
--------
img : PIL.Image
    The transformed image.

label : str
    The transformed label, modified based on the image transformation 
    and the state.
</code></pre>
</div>


                            <div id="ImageAnswerTransform.__init__" class="classattr">
                                        <input id="ImageAnswerTransform.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ImageAnswerTransform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">image_transform</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">text_transform</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">state</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ImageAnswerTransform.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImageAnswerTransform.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImageAnswerTransform.__init__-324"><a href="#ImageAnswerTransform.__init__-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ImageAnswerTransform.__init__-325"><a href="#ImageAnswerTransform.__init__-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span> <span class="o">=</span> <span class="n">image_transform</span>
</span><span id="ImageAnswerTransform.__init__-326"><a href="#ImageAnswerTransform.__init__-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">text_transform</span>
</span><span id="ImageAnswerTransform.__init__-327"><a href="#ImageAnswerTransform.__init__-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="ImageAnswerTransform.image_transform" class="classattr">
                                <div class="attr variable">
            <span class="name">image_transform</span>

        
    </div>
    <a class="headerlink" href="#ImageAnswerTransform.image_transform"></a>
    
    

                            </div>
                            <div id="ImageAnswerTransform.text_transform" class="classattr">
                                <div class="attr variable">
            <span class="name">text_transform</span>

        
    </div>
    <a class="headerlink" href="#ImageAnswerTransform.text_transform"></a>
    
    

                            </div>
                            <div id="ImageAnswerTransform.state" class="classattr">
                                <div class="attr variable">
            <span class="name">state</span>

        
    </div>
    <a class="headerlink" href="#ImageAnswerTransform.state"></a>
    
    

                            </div>
                </section>
                <section id="Rotate180DegreesTransform">
                            <input id="Rotate180DegreesTransform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Rotate180DegreesTransform</span><wbr>(<span class="base"><a href="#ImageAnswerTransform">ImageAnswerTransform</a></span>):

                <label class="view-source-button" for="Rotate180DegreesTransform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rotate180DegreesTransform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rotate180DegreesTransform-338"><a href="#Rotate180DegreesTransform-338"><span class="linenos">338</span></a><span class="k">class</span> <span class="nc">Rotate180DegreesTransform</span><span class="p">(</span><span class="n">ImageAnswerTransform</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform-339"><a href="#Rotate180DegreesTransform-339"><span class="linenos">339</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-340"><a href="#Rotate180DegreesTransform-340"><span class="linenos">340</span></a><span class="sd">    A specialized ImageAnswerTransform that rotates the image by 180 degrees and modifies the answer accordingly.</span>
</span><span id="Rotate180DegreesTransform-341"><a href="#Rotate180DegreesTransform-341"><span class="linenos">341</span></a>
</span><span id="Rotate180DegreesTransform-342"><a href="#Rotate180DegreesTransform-342"><span class="linenos">342</span></a><span class="sd">    This class inherits from ImageAnswerTransform and implements the specific functionality of rotating an image</span>
</span><span id="Rotate180DegreesTransform-343"><a href="#Rotate180DegreesTransform-343"><span class="linenos">343</span></a><span class="sd">    by 180 degrees and transforming the directional answers (&#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;) based on the rotation.</span>
</span><span id="Rotate180DegreesTransform-344"><a href="#Rotate180DegreesTransform-344"><span class="linenos">344</span></a>
</span><span id="Rotate180DegreesTransform-345"><a href="#Rotate180DegreesTransform-345"><span class="linenos">345</span></a><span class="sd">    Methods:</span>
</span><span id="Rotate180DegreesTransform-346"><a href="#Rotate180DegreesTransform-346"><span class="linenos">346</span></a><span class="sd">    --------</span>
</span><span id="Rotate180DegreesTransform-347"><a href="#Rotate180DegreesTransform-347"><span class="linenos">347</span></a><span class="sd">    rotate_image_180(img, state):</span>
</span><span id="Rotate180DegreesTransform-348"><a href="#Rotate180DegreesTransform-348"><span class="linenos">348</span></a><span class="sd">        Rotates the image by 180 degrees clockwise.</span>
</span><span id="Rotate180DegreesTransform-349"><a href="#Rotate180DegreesTransform-349"><span class="linenos">349</span></a><span class="sd">    modify_answer_based_on_rotation(answer, state):</span>
</span><span id="Rotate180DegreesTransform-350"><a href="#Rotate180DegreesTransform-350"><span class="linenos">350</span></a><span class="sd">        Modifies the answer according to the 180-degree rotation.</span>
</span><span id="Rotate180DegreesTransform-351"><a href="#Rotate180DegreesTransform-351"><span class="linenos">351</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-352"><a href="#Rotate180DegreesTransform-352"><span class="linenos">352</span></a>
</span><span id="Rotate180DegreesTransform-353"><a href="#Rotate180DegreesTransform-353"><span class="linenos">353</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform-354"><a href="#Rotate180DegreesTransform-354"><span class="linenos">354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-355"><a href="#Rotate180DegreesTransform-355"><span class="linenos">355</span></a><span class="sd">        Initializes the Rotate180DegreesTransform with predefined image and text transformations.</span>
</span><span id="Rotate180DegreesTransform-356"><a href="#Rotate180DegreesTransform-356"><span class="linenos">356</span></a>
</span><span id="Rotate180DegreesTransform-357"><a href="#Rotate180DegreesTransform-357"><span class="linenos">357</span></a><span class="sd">        Parameters:</span>
</span><span id="Rotate180DegreesTransform-358"><a href="#Rotate180DegreesTransform-358"><span class="linenos">358</span></a><span class="sd">        -----------</span>
</span><span id="Rotate180DegreesTransform-359"><a href="#Rotate180DegreesTransform-359"><span class="linenos">359</span></a><span class="sd">        state : dict, optional</span>
</span><span id="Rotate180DegreesTransform-360"><a href="#Rotate180DegreesTransform-360"><span class="linenos">360</span></a><span class="sd">            A shared state dictionary used to pass information between the image and text transformations.</span>
</span><span id="Rotate180DegreesTransform-361"><a href="#Rotate180DegreesTransform-361"><span class="linenos">361</span></a><span class="sd">            If not provided, it is initialized as an empty dictionary.</span>
</span><span id="Rotate180DegreesTransform-362"><a href="#Rotate180DegreesTransform-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-363"><a href="#Rotate180DegreesTransform-363"><span class="linenos">363</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Rotate180DegreesTransform-364"><a href="#Rotate180DegreesTransform-364"><span class="linenos">364</span></a>            <span class="n">image_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_image_180</span><span class="p">,</span>
</span><span id="Rotate180DegreesTransform-365"><a href="#Rotate180DegreesTransform-365"><span class="linenos">365</span></a>            <span class="n">text_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_answer_based_on_rotation</span><span class="p">,</span>
</span><span id="Rotate180DegreesTransform-366"><a href="#Rotate180DegreesTransform-366"><span class="linenos">366</span></a>            <span class="n">state</span><span class="o">=</span><span class="n">state</span>
</span><span id="Rotate180DegreesTransform-367"><a href="#Rotate180DegreesTransform-367"><span class="linenos">367</span></a>        <span class="p">)</span>
</span><span id="Rotate180DegreesTransform-368"><a href="#Rotate180DegreesTransform-368"><span class="linenos">368</span></a>
</span><span id="Rotate180DegreesTransform-369"><a href="#Rotate180DegreesTransform-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="nf">rotate_image_180</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform-370"><a href="#Rotate180DegreesTransform-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-371"><a href="#Rotate180DegreesTransform-371"><span class="linenos">371</span></a><span class="sd">        Rotate the image by 180 degrees clockwise.</span>
</span><span id="Rotate180DegreesTransform-372"><a href="#Rotate180DegreesTransform-372"><span class="linenos">372</span></a>
</span><span id="Rotate180DegreesTransform-373"><a href="#Rotate180DegreesTransform-373"><span class="linenos">373</span></a><span class="sd">        Parameters:</span>
</span><span id="Rotate180DegreesTransform-374"><a href="#Rotate180DegreesTransform-374"><span class="linenos">374</span></a><span class="sd">        -----------</span>
</span><span id="Rotate180DegreesTransform-375"><a href="#Rotate180DegreesTransform-375"><span class="linenos">375</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="Rotate180DegreesTransform-376"><a href="#Rotate180DegreesTransform-376"><span class="linenos">376</span></a><span class="sd">            The image to be rotated.</span>
</span><span id="Rotate180DegreesTransform-377"><a href="#Rotate180DegreesTransform-377"><span class="linenos">377</span></a><span class="sd">        state : dict</span>
</span><span id="Rotate180DegreesTransform-378"><a href="#Rotate180DegreesTransform-378"><span class="linenos">378</span></a><span class="sd">            The state used for shared information between image and text transformations.</span>
</span><span id="Rotate180DegreesTransform-379"><a href="#Rotate180DegreesTransform-379"><span class="linenos">379</span></a>
</span><span id="Rotate180DegreesTransform-380"><a href="#Rotate180DegreesTransform-380"><span class="linenos">380</span></a><span class="sd">        Returns:</span>
</span><span id="Rotate180DegreesTransform-381"><a href="#Rotate180DegreesTransform-381"><span class="linenos">381</span></a><span class="sd">        --------</span>
</span><span id="Rotate180DegreesTransform-382"><a href="#Rotate180DegreesTransform-382"><span class="linenos">382</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="Rotate180DegreesTransform-383"><a href="#Rotate180DegreesTransform-383"><span class="linenos">383</span></a><span class="sd">            The rotated image.</span>
</span><span id="Rotate180DegreesTransform-384"><a href="#Rotate180DegreesTransform-384"><span class="linenos">384</span></a><span class="sd">        state : dict</span>
</span><span id="Rotate180DegreesTransform-385"><a href="#Rotate180DegreesTransform-385"><span class="linenos">385</span></a><span class="sd">            The unchanged state dictionary.</span>
</span><span id="Rotate180DegreesTransform-386"><a href="#Rotate180DegreesTransform-386"><span class="linenos">386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-387"><a href="#Rotate180DegreesTransform-387"><span class="linenos">387</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">)</span>  <span class="c1"># 180 degrees clockwise</span>
</span><span id="Rotate180DegreesTransform-388"><a href="#Rotate180DegreesTransform-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">state</span>
</span><span id="Rotate180DegreesTransform-389"><a href="#Rotate180DegreesTransform-389"><span class="linenos">389</span></a>
</span><span id="Rotate180DegreesTransform-390"><a href="#Rotate180DegreesTransform-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">modify_answer_based_on_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform-391"><a href="#Rotate180DegreesTransform-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-392"><a href="#Rotate180DegreesTransform-392"><span class="linenos">392</span></a><span class="sd">        Modify the answer based on the 180-degree rotation, assuming directional answers (&#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;).</span>
</span><span id="Rotate180DegreesTransform-393"><a href="#Rotate180DegreesTransform-393"><span class="linenos">393</span></a>
</span><span id="Rotate180DegreesTransform-394"><a href="#Rotate180DegreesTransform-394"><span class="linenos">394</span></a><span class="sd">        Parameters:</span>
</span><span id="Rotate180DegreesTransform-395"><a href="#Rotate180DegreesTransform-395"><span class="linenos">395</span></a><span class="sd">        -----------</span>
</span><span id="Rotate180DegreesTransform-396"><a href="#Rotate180DegreesTransform-396"><span class="linenos">396</span></a><span class="sd">        answer : str</span>
</span><span id="Rotate180DegreesTransform-397"><a href="#Rotate180DegreesTransform-397"><span class="linenos">397</span></a><span class="sd">            The original answer related to the image.</span>
</span><span id="Rotate180DegreesTransform-398"><a href="#Rotate180DegreesTransform-398"><span class="linenos">398</span></a><span class="sd">        state : dict</span>
</span><span id="Rotate180DegreesTransform-399"><a href="#Rotate180DegreesTransform-399"><span class="linenos">399</span></a><span class="sd">            The state used for shared information between image and text transformations.</span>
</span><span id="Rotate180DegreesTransform-400"><a href="#Rotate180DegreesTransform-400"><span class="linenos">400</span></a>
</span><span id="Rotate180DegreesTransform-401"><a href="#Rotate180DegreesTransform-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="Rotate180DegreesTransform-402"><a href="#Rotate180DegreesTransform-402"><span class="linenos">402</span></a><span class="sd">        --------</span>
</span><span id="Rotate180DegreesTransform-403"><a href="#Rotate180DegreesTransform-403"><span class="linenos">403</span></a><span class="sd">        str</span>
</span><span id="Rotate180DegreesTransform-404"><a href="#Rotate180DegreesTransform-404"><span class="linenos">404</span></a><span class="sd">            The modified answer after applying the 180-degree rotation.</span>
</span><span id="Rotate180DegreesTransform-405"><a href="#Rotate180DegreesTransform-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform-406"><a href="#Rotate180DegreesTransform-406"><span class="linenos">406</span></a>        <span class="k">if</span> <span class="n">answer</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
</span><span id="Rotate180DegreesTransform-407"><a href="#Rotate180DegreesTransform-407"><span class="linenos">407</span></a>            <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform-408"><a href="#Rotate180DegreesTransform-408"><span class="linenos">408</span></a>                <span class="k">return</span> <span class="s1">&#39;bottom&#39;</span>
</span><span id="Rotate180DegreesTransform-409"><a href="#Rotate180DegreesTransform-409"><span class="linenos">409</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform-410"><a href="#Rotate180DegreesTransform-410"><span class="linenos">410</span></a>                <span class="k">return</span> <span class="s1">&#39;top&#39;</span>
</span><span id="Rotate180DegreesTransform-411"><a href="#Rotate180DegreesTransform-411"><span class="linenos">411</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform-412"><a href="#Rotate180DegreesTransform-412"><span class="linenos">412</span></a>                <span class="k">return</span> <span class="s1">&#39;right&#39;</span>
</span><span id="Rotate180DegreesTransform-413"><a href="#Rotate180DegreesTransform-413"><span class="linenos">413</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform-414"><a href="#Rotate180DegreesTransform-414"><span class="linenos">414</span></a>                <span class="k">return</span> <span class="s1">&#39;left&#39;</span>
</span><span id="Rotate180DegreesTransform-415"><a href="#Rotate180DegreesTransform-415"><span class="linenos">415</span></a>        
</span><span id="Rotate180DegreesTransform-416"><a href="#Rotate180DegreesTransform-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="n">answer</span>
</span></pre></div>


            <div class="docstring"><p>A specialized ImageAnswerTransform that rotates the image by 180 degrees and modifies the answer accordingly.</p>

<p>This class inherits from ImageAnswerTransform and implements the specific functionality of rotating an image
by 180 degrees and transforming the directional answers ('top', 'bottom', 'left', 'right') based on the rotation.</p>

<h2 id="methods">Methods:</h2>

<p>rotate_image_180(img, state):
    Rotates the image by 180 degrees clockwise.
modify_answer_based_on_rotation(answer, state):
    Modifies the answer according to the 180-degree rotation.</p>
</div>


                            <div id="Rotate180DegreesTransform.__init__" class="classattr">
                                        <input id="Rotate180DegreesTransform.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Rotate180DegreesTransform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Rotate180DegreesTransform.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rotate180DegreesTransform.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rotate180DegreesTransform.__init__-353"><a href="#Rotate180DegreesTransform.__init__-353"><span class="linenos">353</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform.__init__-354"><a href="#Rotate180DegreesTransform.__init__-354"><span class="linenos">354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform.__init__-355"><a href="#Rotate180DegreesTransform.__init__-355"><span class="linenos">355</span></a><span class="sd">        Initializes the Rotate180DegreesTransform with predefined image and text transformations.</span>
</span><span id="Rotate180DegreesTransform.__init__-356"><a href="#Rotate180DegreesTransform.__init__-356"><span class="linenos">356</span></a>
</span><span id="Rotate180DegreesTransform.__init__-357"><a href="#Rotate180DegreesTransform.__init__-357"><span class="linenos">357</span></a><span class="sd">        Parameters:</span>
</span><span id="Rotate180DegreesTransform.__init__-358"><a href="#Rotate180DegreesTransform.__init__-358"><span class="linenos">358</span></a><span class="sd">        -----------</span>
</span><span id="Rotate180DegreesTransform.__init__-359"><a href="#Rotate180DegreesTransform.__init__-359"><span class="linenos">359</span></a><span class="sd">        state : dict, optional</span>
</span><span id="Rotate180DegreesTransform.__init__-360"><a href="#Rotate180DegreesTransform.__init__-360"><span class="linenos">360</span></a><span class="sd">            A shared state dictionary used to pass information between the image and text transformations.</span>
</span><span id="Rotate180DegreesTransform.__init__-361"><a href="#Rotate180DegreesTransform.__init__-361"><span class="linenos">361</span></a><span class="sd">            If not provided, it is initialized as an empty dictionary.</span>
</span><span id="Rotate180DegreesTransform.__init__-362"><a href="#Rotate180DegreesTransform.__init__-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform.__init__-363"><a href="#Rotate180DegreesTransform.__init__-363"><span class="linenos">363</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Rotate180DegreesTransform.__init__-364"><a href="#Rotate180DegreesTransform.__init__-364"><span class="linenos">364</span></a>            <span class="n">image_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_image_180</span><span class="p">,</span>
</span><span id="Rotate180DegreesTransform.__init__-365"><a href="#Rotate180DegreesTransform.__init__-365"><span class="linenos">365</span></a>            <span class="n">text_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_answer_based_on_rotation</span><span class="p">,</span>
</span><span id="Rotate180DegreesTransform.__init__-366"><a href="#Rotate180DegreesTransform.__init__-366"><span class="linenos">366</span></a>            <span class="n">state</span><span class="o">=</span><span class="n">state</span>
</span><span id="Rotate180DegreesTransform.__init__-367"><a href="#Rotate180DegreesTransform.__init__-367"><span class="linenos">367</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the Rotate180DegreesTransform with predefined image and text transformations.</p>

<h2 id="parameters">Parameters:</h2>

<p>state : dict, optional
    A shared state dictionary used to pass information between the image and text transformations.
    If not provided, it is initialized as an empty dictionary.</p>
</div>


                            </div>
                            <div id="Rotate180DegreesTransform.rotate_image_180" class="classattr">
                                        <input id="Rotate180DegreesTransform.rotate_image_180-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rotate_image_180</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">img</span>, </span><span class="param"><span class="n">state</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Rotate180DegreesTransform.rotate_image_180-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rotate180DegreesTransform.rotate_image_180"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rotate180DegreesTransform.rotate_image_180-369"><a href="#Rotate180DegreesTransform.rotate_image_180-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="nf">rotate_image_180</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-370"><a href="#Rotate180DegreesTransform.rotate_image_180-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-371"><a href="#Rotate180DegreesTransform.rotate_image_180-371"><span class="linenos">371</span></a><span class="sd">        Rotate the image by 180 degrees clockwise.</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-372"><a href="#Rotate180DegreesTransform.rotate_image_180-372"><span class="linenos">372</span></a>
</span><span id="Rotate180DegreesTransform.rotate_image_180-373"><a href="#Rotate180DegreesTransform.rotate_image_180-373"><span class="linenos">373</span></a><span class="sd">        Parameters:</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-374"><a href="#Rotate180DegreesTransform.rotate_image_180-374"><span class="linenos">374</span></a><span class="sd">        -----------</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-375"><a href="#Rotate180DegreesTransform.rotate_image_180-375"><span class="linenos">375</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-376"><a href="#Rotate180DegreesTransform.rotate_image_180-376"><span class="linenos">376</span></a><span class="sd">            The image to be rotated.</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-377"><a href="#Rotate180DegreesTransform.rotate_image_180-377"><span class="linenos">377</span></a><span class="sd">        state : dict</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-378"><a href="#Rotate180DegreesTransform.rotate_image_180-378"><span class="linenos">378</span></a><span class="sd">            The state used for shared information between image and text transformations.</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-379"><a href="#Rotate180DegreesTransform.rotate_image_180-379"><span class="linenos">379</span></a>
</span><span id="Rotate180DegreesTransform.rotate_image_180-380"><a href="#Rotate180DegreesTransform.rotate_image_180-380"><span class="linenos">380</span></a><span class="sd">        Returns:</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-381"><a href="#Rotate180DegreesTransform.rotate_image_180-381"><span class="linenos">381</span></a><span class="sd">        --------</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-382"><a href="#Rotate180DegreesTransform.rotate_image_180-382"><span class="linenos">382</span></a><span class="sd">        img : PIL.Image</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-383"><a href="#Rotate180DegreesTransform.rotate_image_180-383"><span class="linenos">383</span></a><span class="sd">            The rotated image.</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-384"><a href="#Rotate180DegreesTransform.rotate_image_180-384"><span class="linenos">384</span></a><span class="sd">        state : dict</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-385"><a href="#Rotate180DegreesTransform.rotate_image_180-385"><span class="linenos">385</span></a><span class="sd">            The unchanged state dictionary.</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-386"><a href="#Rotate180DegreesTransform.rotate_image_180-386"><span class="linenos">386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-387"><a href="#Rotate180DegreesTransform.rotate_image_180-387"><span class="linenos">387</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">)</span>  <span class="c1"># 180 degrees clockwise</span>
</span><span id="Rotate180DegreesTransform.rotate_image_180-388"><a href="#Rotate180DegreesTransform.rotate_image_180-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">state</span>
</span></pre></div>


            <div class="docstring"><p>Rotate the image by 180 degrees clockwise.</p>

<h2 id="parameters">Parameters:</h2>

<p>img : PIL.Image
    The image to be rotated.
state : dict
    The state used for shared information between image and text transformations.</p>

<h2 id="returns">Returns:</h2>

<p>img : PIL.Image
    The rotated image.
state : dict
    The unchanged state dictionary.</p>
</div>


                            </div>
                            <div id="Rotate180DegreesTransform.modify_answer_based_on_rotation" class="classattr">
                                        <input id="Rotate180DegreesTransform.modify_answer_based_on_rotation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modify_answer_based_on_rotation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">answer</span>, </span><span class="param"><span class="n">state</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Rotate180DegreesTransform.modify_answer_based_on_rotation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rotate180DegreesTransform.modify_answer_based_on_rotation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-390"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">modify_answer_based_on_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-391"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-392"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-392"><span class="linenos">392</span></a><span class="sd">        Modify the answer based on the 180-degree rotation, assuming directional answers (&#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;).</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-393"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-393"><span class="linenos">393</span></a>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-394"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-394"><span class="linenos">394</span></a><span class="sd">        Parameters:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-395"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-395"><span class="linenos">395</span></a><span class="sd">        -----------</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-396"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-396"><span class="linenos">396</span></a><span class="sd">        answer : str</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-397"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-397"><span class="linenos">397</span></a><span class="sd">            The original answer related to the image.</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-398"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-398"><span class="linenos">398</span></a><span class="sd">        state : dict</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-399"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-399"><span class="linenos">399</span></a><span class="sd">            The state used for shared information between image and text transformations.</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-400"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-400"><span class="linenos">400</span></a>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-401"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-402"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-402"><span class="linenos">402</span></a><span class="sd">        --------</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-403"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-403"><span class="linenos">403</span></a><span class="sd">        str</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-404"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-404"><span class="linenos">404</span></a><span class="sd">            The modified answer after applying the 180-degree rotation.</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-405"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-406"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-406"><span class="linenos">406</span></a>        <span class="k">if</span> <span class="n">answer</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-407"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-407"><span class="linenos">407</span></a>            <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-408"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-408"><span class="linenos">408</span></a>                <span class="k">return</span> <span class="s1">&#39;bottom&#39;</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-409"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-409"><span class="linenos">409</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-410"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-410"><span class="linenos">410</span></a>                <span class="k">return</span> <span class="s1">&#39;top&#39;</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-411"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-411"><span class="linenos">411</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-412"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-412"><span class="linenos">412</span></a>                <span class="k">return</span> <span class="s1">&#39;right&#39;</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-413"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-413"><span class="linenos">413</span></a>            <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-414"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-414"><span class="linenos">414</span></a>                <span class="k">return</span> <span class="s1">&#39;left&#39;</span>
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-415"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-415"><span class="linenos">415</span></a>        
</span><span id="Rotate180DegreesTransform.modify_answer_based_on_rotation-416"><a href="#Rotate180DegreesTransform.modify_answer_based_on_rotation-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="n">answer</span>
</span></pre></div>


            <div class="docstring"><p>Modify the answer based on the 180-degree rotation, assuming directional answers ('top', 'bottom', 'left', 'right').</p>

<h2 id="parameters">Parameters:</h2>

<p>answer : str
    The original answer related to the image.
state : dict
    The state used for shared information between image and text transformations.</p>

<h2 id="returns">Returns:</h2>

<p>str
    The modified answer after applying the 180-degree rotation.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ImageAnswerTransform">ImageAnswerTransform</a></dt>
                                <dd id="Rotate180DegreesTransform.image_transform" class="variable"><a href="#ImageAnswerTransform.image_transform">image_transform</a></dd>
                <dd id="Rotate180DegreesTransform.text_transform" class="variable"><a href="#ImageAnswerTransform.text_transform">text_transform</a></dd>
                <dd id="Rotate180DegreesTransform.state" class="variable"><a href="#ImageAnswerTransform.state">state</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>